!function(){"use strict";var e={852:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;var s=r(689),o=r(753),u=n(r(748)),l=r(62),d=n(r(350)),c=n(r(268)),g=r(61),h=r(645),f=r(489);function p(e,t,r){return e<=r&&r<=t}var b=function(){function e(){var t=this;this.lastUpdateTimestamp=0,this.targetWidth=1,this.targetHeight=1,this.squareVBO=l.VBO.createQuad(o.gl,-1,-1,1,1),this.greyscaleTexture=new h.ImageTexture,this.greyscaleTexture.loadFromUrl("./resources/greyscale.png"),this.colorscaleTexture=new h.ImageTexture,this.colorscaleTexture.loadFromUrl("./resources/colorscale.png"),this.internalTextures=[new f.RenderToTextureSwapable,new f.RenderToTextureSwapable,new f.RenderToTextureSwapable],this.needToReset=!0,this.lastIterationUpdate=performance.now()-5e3,this.iteration=0,this.asyncLoadShader("display-monochrome","display/display.vert","display/display-monochrome.frag",(function(e){t.displayMonochromeShader=e})),this.asyncLoadShader("display-tricolor","display/display.vert","display/display-tricolor.frag",(function(e){t.displayTricolorShader=e})),this.asyncLoadShader("display-ramp","display/display.vert","display/display-ramp.frag",(function(e){t.displayRampShader=e})),this.asyncLoadShader("update-uniform","update/update.vert","update/update-uniform.frag",(function(e){t.updateUniformShader=e})),this.asyncLoadShader("update-map","update/update.vert","update/update-map.frag",(function(e){t.updateMapShader=e}),{A_FEEDING_MIN:e.A_FEEDING_MIN.toFixed(5),A_FEEDING_MAX:e.A_FEEDING_MAX.toFixed(5),B_KILLING_MIN:e.B_KILLING_MIN.toFixed(5),B_KILLING_MAX:e.B_KILLING_MAX.toFixed(5)}),this.asyncLoadShader("update-image","update/update.vert","update/update-map-image.frag",(function(e){t.updateImageMapShader=e})),this.asyncLoadShader("reset","update/update.vert","update/reset.frag",(function(e){t.resetShader=e})),this.asyncLoadShader("brush-apply","update/brush.vert","update/brush-apply.frag",(function(e){t.brushApplyShader=e})),this.asyncLoadShader("brush-display","update/brush.vert","update/brush-display.frag",(function(e){t.brushDisplayShader=e}))}return e.prototype.resize=function(e,t){this.targetWidth=e,this.targetHeight=t},e.prototype.reset=function(){this.needToReset=!0},e.prototype.drawToCanvas=function(){var e;o.gl.viewport(0,0,this.targetWidth,this.targetHeight);var t=g.Parameters.displayMode;if(t===s.EDisplayMode.MONOCHROME){var r=g.Parameters.shading;r===s.EShading.BINARY?this.displayMonochromeShader&&(this.displayMonochromeShader.u.uTexture.value=this.internalTextures[0].current,e=this.displayMonochromeShader):this.displayRampShader&&(this.displayRampShader.u.uTexture.value=this.internalTextures[0].current,r===s.EShading.GREYSCALE?this.displayRampShader.u.uRamp.value=this.greyscaleTexture.id:this.displayRampShader.u.uRamp.value=this.colorscaleTexture.id,e=this.displayRampShader)}else t===s.EDisplayMode.TRICOLOR&&this.displayTricolorShader&&(this.displayTricolorShader.u.uTextureRed.value=this.internalTextures[0].current,this.displayTricolorShader.u.uTextureGreen.value=this.internalTextures[1].current,this.displayTricolorShader.u.uTextureBlue.value=this.internalTextures[2].current,e=this.displayTricolorShader);if(e){if(g.Parameters.parametersMap===s.EParametersMap.IMAGE){var a=this.targetWidth/this.targetHeight,i=this.internalTextures[0].width/this.internalTextures[0].height;e.u.uScaling.value=a>i?[i/a,1]:[1,a/i]}else e.u.uScaling.value=[1,1];e.u.uZoom.value=g.Parameters.zoom,o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,null),e.use(),e.bindUniformsAndAttributes(),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4)}},e.prototype.update=function(){if(this.adjustInternalTextureSize()&&(this.needToReset=!0),o.gl.viewport(0,0,this.internalTextures[0].width,this.internalTextures[0].height),this.needToReset){if(this.iteration=0,!this.clearInternalTextures())return;this.needToReset=!1}this.handleBrush();var e=this.computeNbIterationsForThisFrame();if(!(e<=0)){var t=g.Parameters.parametersMap;if(t===s.EParametersMap.IMAGE){if(this.updateImageMapShader){var r=d.getTexture();if(this.updateImageMapShader.u.uImageMapTexture.value=r.id,this.updateImageMapShader.u.uDiffuseScaling.value=g.Parameters.patternsScale,this.updateImageMapShader.u.uTexelSize.value=[1/this.internalTextures[0].width,1/this.internalTextures[0].height],this.updateImageMapShader.use(),this.updateImageMapShader.bindAttributes(),g.Parameters.displayMode===s.EDisplayMode.MONOCHROME)this.updateImageMapShader.u.uSampledChannel.value=[0,0,0,1],this.updateInternal(this.updateImageMapShader,e,this.internalTextures[0]);else{var a=Math.ceil(e/3);this.updateImageMapShader.u.uSampledChannel.value=[1,0,0,0],this.updateInternal(this.updateImageMapShader,a,this.internalTextures[0]),this.updateImageMapShader.u.uSampledChannel.value=[0,1,0,0],this.updateInternal(this.updateImageMapShader,a,this.internalTextures[1]),this.updateImageMapShader.u.uSampledChannel.value=[0,0,1,0],this.updateInternal(this.updateImageMapShader,a,this.internalTextures[2])}}}else{var i=void 0;t===s.EParametersMap.UNIFORM?this.updateUniformShader&&(this.updateUniformShader.u.uRates.value=[g.Parameters.AFeedingRate,g.Parameters.BKillingRate,g.Parameters.ADiffusionRate,g.Parameters.BDIffusionRate],i=this.updateUniformShader):t===s.EParametersMap.VALUE_PICKING&&this.updateMapShader&&(this.updateMapShader.u.uRates.value=[g.Parameters.ADiffusionRate,g.Parameters.BDIffusionRate],i=this.updateMapShader),i&&(i.use(),i.bindAttributes(),i.u.uTexelSize.value=[1/this.internalTextures[0].width,1/this.internalTextures[0].height],this.updateInternal(i,e,this.internalTextures[0]))}}},e.prototype.updateInternal=function(e,t,r){for(var a=t;a>0;a--)r.swap(),o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,r.currentFramebuffer),e.u.uPreviousIteration.value=r.previous,e.bindUniforms(),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4);this.iteration=this._iteration+t},e.prototype.displayBrush=function(){if(g.Parameters.parametersMap!==s.EParametersMap.VALUE_PICKING&&this.brushDisplayShader){var e=g.Parameters.brushSize,t=Page.Canvas.getMousePosition();this.brushDisplayShader.u.uPosition.value=[2*(t[0]-.5),-2*(t[1]-.5)],this.brushDisplayShader.u.uSize.value=[e/this.targetWidth,e/this.targetHeight],o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,null),this.brushDisplayShader.use(),this.brushDisplayShader.bindUniformsAndAttributes(),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4)}},e.prototype.handleBrush=function(){var e=g.Parameters.parametersMap;if(e!==s.EParametersMap.VALUE_PICKING&&this.brushApplyShader&&Page.Canvas.isMouseDown()){var t=Page.Canvas.getMousePosition();if(p(0,1,t[0])&&p(0,1,t[1])){var r=g.Parameters.brushSize,a=g.Parameters.zoom,i=[2*(t[0]-.5)/a,-2*(t[1]-.5)/a];if(e===s.EParametersMap.IMAGE){var n=this.targetWidth/this.targetHeight,u=this.internalTextures[0].width/this.internalTextures[0].height;n>u?i[0]*=n/u:n<u&&(i[1]*=u/n)}this.brushApplyShader.u.uPosition.value=i,this.brushApplyShader.u.uSize.value=[r/this.internalTextures[0].width/a,r/this.internalTextures[0].height/a],this.brushApplyShader.use(),this.brushApplyShader.bindUniformsAndAttributes();for(var l=0,d=this.internalTextures;l<d.length;l++){var c=d[l];o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,c.currentFramebuffer),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4)}}}},e.prototype.clearInternalTextures=function(){if(this.resetShader){var e=g.Parameters.initialState;this.resetShader.u.uPattern.value=[e===s.EInitialState.BLANK,e===s.EInitialState.DISC,e===s.EInitialState.CIRCLE,0],this.resetShader.use(),this.resetShader.bindUniformsAndAttributes();for(var t=0,r=this.internalTextures;t<r.length;t++){var a=r[t];o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,a.currentFramebuffer),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4)}return!0}return!1},e.prototype.adjustInternalTextureSize=function(){var e=this.targetWidth,t=this.targetHeight;if(g.Parameters.parametersMap===s.EParametersMap.IMAGE){var r=this.targetWidth/this.targetHeight,a=d.getTexture().width/d.getTexture().height;r>a?e=Math.ceil(a/r*this.targetWidth):r<a&&(t=Math.ceil(r/a*this.targetHeight))}if(this.internalTextures[0].width!==e||this.internalTextures[0].height!==t){for(var i=0,n=this.internalTextures;i<n.length;i++)n[i].reserveSpace(e,t);return!0}return!1},Object.defineProperty(e.prototype,"iteration",{set:function(e){this._iteration=e;var t=performance.now();t-this.lastIterationUpdate>200&&(Page.Canvas.setIndicatorText("iteration-indicator",this._iteration.toString()),this.lastIterationUpdate=t)},enumerable:!1,configurable:!0}),e.prototype.computeNbIterationsForThisFrame=function(){var e=g.Parameters.speed,t=performance.now(),r=1e3/(.1+t-this.lastUpdateTimestamp);return this.lastUpdateTimestamp=t,r>60?Math.ceil(60/r*e):r<10?Math.ceil(r/10*e):e},e.prototype.asyncLoadShader=function(e,t,r,a,i){var n=this;void 0===i&&(i={});var s="shader-"+e;c.registerLoadingObject(s),u.buildShader({fragmentFilename:r,vertexFilename:t,injected:i},(function(t){c.registerLoadedObject(s),null!==t?(t.a.aCorner.VBO=n.squareVBO,a(t)):Page.Demopage.setErrorMessage(e+"-shader-error","Failed to build '"+e+"' shader.")}))},e.A_FEEDING_MIN=.01,e.A_FEEDING_MAX=.1,e.B_KILLING_MIN=.045,e.B_KILLING_MAX=.07,e}();t.Engine=b},689:function(e,t){var r,a,i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.EParametersMap=t.EShading=t.EInitialState=t.EDisplayMode=void 0,function(e){e.UNIFORM="uniform",e.VALUE_PICKING="value_picking",e.IMAGE="image"}(r||(r={})),t.EParametersMap=r,function(e){e.BLANK="blank",e.DISC="disc",e.CIRCLE="circle"}(a||(a={})),t.EInitialState=a,function(e){e.MONOCHROME="monochrome",e.TRICOLOR="tricolor"}(i||(i={})),t.EDisplayMode=i,function(e){e.BINARY="binary",e.GREYSCALE="greyscale",e.COLORSCALE="colorscale"}(n||(n={})),t.EShading=n},667:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerFrame=void 0,r(457);var a=0,i=performance.now();setInterval((function(){var e=performance.now(),t=1e3*a/(e-i);i=e,a=0,Page.Canvas.setIndicatorText("fps-indicator",Math.round(t).toString())}),500),t.registerFrame=function(){a++}},753:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.gl=t.initGL=t.adjustSize=void 0,r(457);var a=null;t.gl=a,t.initGL=function(e){function r(e){Page.Demopage.setErrorMessage("webgl-support",e)}var i=Page.Canvas.getCanvas();if(t.gl=a=i.getContext("webgl",e),null==a){if(t.gl=a=i.getContext("experimental-webgl",e),null==a)return r("Your browser or device does not seem to support WebGL."),!1;r("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.BLEND),a.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,r=a.canvas,i=Math.floor(r.clientWidth*t),n=Math.floor(r.clientHeight*t);r.width===i&&r.height===n||(r.width=i,r.height=n)}},771:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GLResource=void 0;var r=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.GLResource=r},748:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteShader=t.registerShader=t.getShader=t.buildShader=void 0;var s=r(753),o=r(490),u=n(r(71)),l={};function d(e,t){var r=2,a=0;function i(i){function n(t){return t.replace(/#INJECT\(([^)]*)\)/gm,(function(t,r){return e.injected[r]?e.injected[r]:t}))}if(r--,i||a++,0===r){var l=null;if(0===a){var d=u.getSource(e.vertexFilename),c=u.getSource(e.fragmentFilename),g=n(d),h=n(c);l=new o.Shader(s.gl,g,h)}t(l)}}u.loadSource(e.vertexFilename,i),u.loadSource(e.fragmentFilename,i)}t.getShader=function(e){return l[e].shader},t.buildShader=d,t.registerShader=function(e,t,r){function a(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===l[e]){l[e]={callbacks:[r],failed:!1,infos:t,pending:!0,shader:null};var i=l[e];d(t,(function(e){i.pending=!1,i.failed=null===e,i.shader=e,a(i)}))}else{var n=l[e];!0===n.pending?n.callbacks.push(r):a(n)}},t.deleteShader=function(e){void 0!==l[e]&&(null!==l[e].shader&&l[e].shader.freeGLResources(),delete l[e])}},71:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loadSource=t.getSource=void 0;var r={};t.loadSource=function(e,t){function a(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed);e.callbacks=[]}if(void 0===r[e]){r[e]={callbacks:[t],failed:!1,pending:!0,text:null};var i=r[e],n="./shaders/"+e;void 0!==Page.version&&(n+="?v="+Page.version);var s=new XMLHttpRequest;s.open("GET",n,!0),s.onload=function(){4===s.readyState&&(i.pending=!1,200===s.status?(i.text=s.responseText,i.failed=!1):(console.error("Cannot load '"+e+"' shader source: "+s.statusText),i.failed=!0),a(i))},s.onerror=function(){console.error("Cannot load '"+e+"' shader source: "+s.statusText),i.pending=!1,i.failed=!0,a(i)},s.send(null)}else{var o=r[e];!0===o.pending?o.callbacks.push(t):(o.callbacks=[t],a(o))}},t.getSource=function(e){return r[e].text}},490:function(e,t,r){var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;var n=r(771);function s(){alert("NOT IMPLEMENTED YET")}var o={35664:{str:"FLOAT_VEC2",binder:function(e,t,r){e.uniform2fv(t,r)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,r){e.uniform3fv(t,r)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,r){e.uniform4fv(t,r)}},35667:{str:"INT_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35668:{str:"INT_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35669:{str:"INT_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35670:{str:"BOOL",binder:function(e,t,r){e.uniform1i(t,+r)}},35671:{str:"BOOL_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35672:{str:"BOOL_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35673:{str:"BOOL_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,r){e.uniformMatrix2fv(t,!1,r)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,r){e.uniformMatrix3fv(t,!1,r)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,r){e.uniformMatrix4fv(t,!1,r)}},35678:{str:"SAMPLER_2D",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_2D,a)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_CUBE_MAP,a)}},5120:{str:"BYTE",binder:s},5121:{str:"UNSIGNED_BYTE",binder:s},5122:{str:"SHORT",binder:s},5123:{str:"UNSIGNED_SHORT",binder:s},5124:{str:"INT",binder:function(e,t,r){Array.isArray(r),e.uniform1iv(t,r)}},5125:{str:"UNSIGNED_INT",binder:s},5126:{str:"FLOAT",binder:function(e,t,r){Array.isArray(r)?e.uniform1fv(t,r):e.uniform1f(t,r)}}},u=function(e){function t(t,r,a){var i=this;function n(e,r){var a=t.createShader(e);return t.shaderSource(a,r),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(console.error(t.getShaderInfoLog(a)),console.log(r),t.deleteShader(a),null)}(i=e.call(this,t)||this).id=null,i.uCount=0,i.aCount=0;var s=n(t.VERTEX_SHADER,r),o=n(t.FRAGMENT_SHADER,a),u=t.createProgram();return t.attachShader(u,s),t.attachShader(u,o),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)?(i.id=u,i.introspection()):(console.error(t.getProgramInfoLog(u)),t.deleteProgram(u)),i}return i(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,r=e.prototype.gl.call(this),a=0;Object.keys(this.u).forEach((function(e){var i=t.u[e];if(null!==i.value)if(35678===i.type||35680===i.type){var n=a;o[i.type].binder(r,i.loc,n,i.value),a++}else o[i.type].binder(r,i.loc,i.value)}))},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach((function(t){var r=e.a[t];null!==r.VBO&&r.VBO.bind(r.loc)}))},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u={};for(var r=0;r<this.uCount;r++){var a=t.getActiveUniform(this.id,r),i=a.name;this.u[i]={loc:t.getUniformLocation(this.id,i),size:a.size,type:a.type,value:null}}for(this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a={},r=0;r<this.aCount;r++){var n=t.getActiveAttrib(this.id,r),s=n.name;this.a[s]={VBO:null,loc:t.getAttribLocation(this.id,s),size:n.size,type:n.type}}},t}(n.GLResource);t.Shader=u},62:function(e,t,r){var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.VBO=void 0;var n,s=r(771);!function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.STATIC=1]="STATIC"}(n||(n={}));var o=function(e){function t(t,r,a,i,s){void 0===s&&(s=!0);var o=e.call(this,t)||this;return o.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o.id),s?t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW):t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),o.size=a,o.type=i,o.normalize=!1,o.stride=0,o.offset=0,o.usage=s?n.STATIC:n.DYNAMIC,o}return i(t,e),t.createQuad=function(e,r,a,i,n){return new t(e,new Float32Array([r,a,i,a,r,n,i,n]),2,e.FLOAT,!0)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var r=e.prototype.gl.call(this);r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,this.id),r.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t.prototype.setData=function(t){var r=e.prototype.gl.call(this);r.bindBuffer(r.ARRAY_BUFFER,this.id),this.usage===n.STATIC?r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW):r.bufferData(r.ARRAY_BUFFER,t,r.DYNAMIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null)},t}(s.GLResource);t.VBO=o},350:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getTexture=void 0;var a,i=r(61),n=r(645),s=document.createElement("canvas"),o=s.getContext("2d"),u=null;function l(e,t,r){return.21*e+.72*t+.07*r}i.Parameters.imageUploadObservers.push((function(e){a=function(e){var t=Math.min(1,512/Math.max(e.width,e.height)),r=Math.ceil(t*e.width),a=Math.ceil(t*e.height);s.width=r,s.height=a,o.drawImage(e,0,0,r,a);for(var i=o.getImageData(0,0,s.width,s.height),n=new Uint8ClampedArray(i.data),u=0,d=i.height-1;d>=0;d--)for(var c=0;c<i.width;c++){var g=n[4*(c+d*i.width)],h=n[4*(c+d*i.width)+1],f=n[4*(c+d*i.width)+2],p=l(g,h,f);i.data[u++]=g,i.data[u++]=h,i.data[u++]=f,i.data[u++]=p}return i}(e),null!==u&&u.uploadToGPU(a)})),t.getTexture=function(){return null===u&&(u=new n.ImageTexture(a)),u}},268:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerLoadingObject=t.registerLoadedObject=void 0,r(457);var a={};t.registerLoadingObject=function(e){0===Object.keys(a).length&&Page.Canvas.showLoader(!0),a[e]=!1},t.registerLoadedObject=function(e){delete a[e],0===Object.keys(a).length&&Page.Canvas.showLoader(!1)}},633:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var s=r(852),o=n(r(667)),u=n(r(753)),l=r(753),d=r(61),c=r(336);function g(e){var t=d.Parameters.blur;e.style.filter=t<=0?"":"blur("+t+"px)"}r(457),function(){if(u.initGL({alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!1})){l.gl.disable(l.gl.CULL_FACE),l.gl.disable(l.gl.BLEND),l.gl.disable(l.gl.DEPTH_TEST),l.gl.disable(l.gl.STENCIL_TEST);var e=Page.Canvas.getCanvas();d.Parameters.blurChangeObservers.push((function(){g(e)})),g(e);var t=!0;d.Parameters.canvasResizeObservers.push((function(){t=!0}));var r=!0;d.Parameters.resetObservers.push((function(){r=!0}));var a=!1;d.Parameters.imageDownloadObservers.push((function(){a=!0}));var i=new s.Engine,n=new c.Visor;!function s(){o.registerFrame(),a&&(i.drawToCanvas(),function(e){var t="reaction-diffusion.png";if(e.msToBlob){var r=e.msToBlob();window.navigator.msSaveBlob(r,t)}else e.toBlob((function(e){var r=document.createElement("a");r.download=t,r.href=URL.createObjectURL(e),r.click()}))}(e),a=!1),t&&(u.adjustSize(!1),i.resize(e.width,e.height),t=!1),r&&(i.reset(),r=!1),i.update(),i.drawToCanvas(),n.update(),d.Parameters.displayBrush&&i.displayBrush(),requestAnimationFrame(s)}()}}()},457:function(){},61:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=void 0;var s=r(689),o=n(r(268)),u=r(470);r(457);var l="map-tabs-id",d="presets-fixed-select-id",c="input-image-upload-button",g="pattern-scale-range-id",h="A-feeding-range-id",f="A-diffusion-range-id",p="B-killing-range-id",b="B-diffusion-range-id",v="pick-values-button-id",m="speed-range-id",E="initial-state-tabs-id",P="display-mode-tabs-id",T="shading-tabs-id",y="zoom-range-id",S="blur-range-id",R="indicators-checkbox-id";function _(e){for(var t=0,r=e;t<r.length;t++)(0,r[t])()}var I=!1,M=function(){var e=A.parametersMap,t=A.displayMode;Page.Controls.setVisibility(d,e!==s.EParametersMap.IMAGE),Page.Controls.setVisibility(h,e!==s.EParametersMap.IMAGE),Page.Controls.setVisibility(p,e!==s.EParametersMap.IMAGE),Page.Controls.setVisibility(v,e!==s.EParametersMap.IMAGE),Page.Controls.setVisibility(g,e===s.EParametersMap.IMAGE),Page.Controls.setVisibility(f,e!==s.EParametersMap.IMAGE),Page.Controls.setVisibility(b,e!==s.EParametersMap.IMAGE),Page.Controls.setVisibility(c,e===s.EParametersMap.IMAGE),Page.Controls.setVisibility(P,e===s.EParametersMap.IMAGE),Page.Controls.setVisibility(T,t===s.EDisplayMode.MONOCHROME)};function O(){Page.Select.setValue(d,null)}Page.Range.addObserver(h,O),Page.Range.addObserver(f,O),Page.Range.addObserver(p,O),Page.Range.addObserver(b,O);var A=function(){function e(){}return Object.defineProperty(e,"parametersMap",{get:function(){return I?s.EParametersMap.VALUE_PICKING:Page.Tabs.getValues(l)[0]},enumerable:!1,configurable:!0}),e.exitValuePickingMode=function(){I=!1,Page.Tabs.setValues(l,[s.EParametersMap.UNIFORM]),M()},Object.defineProperty(e,"patternsScale",{get:function(){return Page.Range.getValue(g)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"AFeedingRate",{get:function(){return Page.Range.getValue(h)},set:function(e){Page.Range.setValue(h,e),Page.Range.storeState(h),O()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ADiffusionRate",{get:function(){return Page.Range.getValue(f)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BKillingRate",{get:function(){return Page.Range.getValue(p)},set:function(e){Page.Range.setValue(p,e),Page.Range.storeState(p),O()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BDIffusionRate",{get:function(){return Page.Range.getValue(b)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"speed",{get:function(){return Page.Range.getValue(m)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"brushSize",{get:function(){return Page.Range.getValue("brush-size-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayBrush",{get:function(){return!I&&Page.Checkbox.isChecked("brush-display-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"initialState",{get:function(){return I?s.EInitialState.CIRCLE:Page.Tabs.getValues(E)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"zoom",{get:function(){return Page.Range.getValue(y)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"blur",{get:function(){return Page.Range.getValue(S)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayMode",{get:function(){return e.parametersMap===s.EParametersMap.IMAGE?Page.Tabs.getValues(P)[0]:s.EDisplayMode.MONOCHROME},enumerable:!1,configurable:!0}),Object.defineProperty(e,"shading",{get:function(){return Page.Tabs.getValues(T)[0]},enumerable:!1,configurable:!0}),e.imageUploadObservers=[],e.imageDownloadObservers=[],e.canvasResizeObservers=[],e.resetObservers=[],e.blurChangeObservers=[],e}();t.Parameters=A,Page.Canvas.Observers.canvasResize.push((function(){_(A.canvasResizeObservers)}));var C=function(){_(A.resetObservers)};Page.Select.addObserver(d,C),Page.Button.addObserver("reset-button-id",C),Page.Tabs.addObserver(l,C),Page.Tabs.addObserver(P,C),Page.Tabs.addObserver(E,C),A.imageUploadObservers.push(C),Page.Tabs.addObserver(l,(function(){I=!1,M(),A.parametersMap===s.EParametersMap.IMAGE&&(Page.Range.setValue(y,1),Page.Range.setValue(m,40),Page.Tabs.setValues(E,[s.EInitialState.CIRCLE]),Page.Tabs.setValues(T,[s.EShading.BINARY]),Page.Range.clearStoredState(y),Page.Range.clearStoredState(m),Page.Tabs.clearStoredState(E),Page.Tabs.clearStoredState(T),Page.Select.clearStoredState(d))})),Page.Tabs.addObserver(P,M),M();var x=function(){Page.Canvas.setIndicatorsVisibility(Page.Checkbox.isChecked(R))};Page.Checkbox.addObserver(R,x),x(),Page.Button.addObserver(v,(function(){Page.Tabs.setValues(l,[]),I=!0,Page.Range.setValue(f,.2097),Page.Range.setValue(b,.105),Page.Range.setValue(y,1),A.speed<30&&Page.Range.setValue(m,30),O(),M(),C()})),Page.Range.addObserver(S,(function(){_(A.blurChangeObservers)})),Page.FileControl.addUploadObserver(c,(function(e){if(1===e.length){var t=new FileReader;t.onload=function(){var e=new Image;e.addEventListener("load",(function(){for(var t=0,r=A.imageUploadObservers;t<r.length;t++)(0,r[t])(e)})),e.src=t.result},t.readAsDataURL(e[0])}}));var L="./resources/cat.jpg?v="+Page.version;o.registerLoadingObject(L);var F=new Image;function D(){if(A.parametersMap===s.EParametersMap.UNIFORM){var e=Page.Select.getValue(d),t=u.Presets[e];t&&(Page.Range.setValue(h,t.aFeeding),Page.Range.setValue(f,t.aDiffuse),Page.Range.setValue(p,t.bKilling),Page.Range.setValue(b,t.bDiffuse),Page.Range.setValue(m,t.speed),Page.Range.setValue(y,t.zoom),Page.Tabs.setValues(E,[t.initialState]),Page.Tabs.setValues(T,[t.shading]),Page.Range.clearStoredState(h),Page.Range.clearStoredState(f),Page.Range.clearStoredState(p),Page.Range.clearStoredState(b),Page.Range.clearStoredState(m),Page.Range.clearStoredState(y),Page.Tabs.clearStoredState(E),Page.Tabs.clearStoredState(T))}}F.addEventListener("load",(function(){o.registerLoadedObject(L);for(var e=0,t=A.imageUploadObservers;e<t.length;e++)(0,t[e])(F)})),F.src=L,Page.FileControl.addDownloadObserver("image-download-id",(function(){_(A.imageDownloadObservers),C()})),Page.Select.addObserver(d,(function(){A.exitValuePickingMode(),D()})),Page.Tabs.addObserver(l,D),D(),Page.Canvas.Observers.mouseDrag.push((function(){}))},470:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Presets=void 0;var a=r(689),i={0:{aFeeding:.015,aDiffuse:.21,bKilling:.049,bDiffuse:.105,speed:8,zoom:3,initialState:a.EInitialState.DISC,shading:a.EShading.COLORSCALE},1:{aFeeding:.037,aDiffuse:.5,bKilling:.059,bDiffuse:.342,speed:100,zoom:1,initialState:a.EInitialState.CIRCLE,shading:a.EShading.BINARY},2:{aFeeding:.058,aDiffuse:.21,bKilling:.063,bDiffuse:.105,speed:60,zoom:1,initialState:a.EInitialState.CIRCLE,shading:a.EShading.GREYSCALE},3:{aFeeding:.021,aDiffuse:.21,bKilling:.056,bDiffuse:.105,speed:10,zoom:2,initialState:a.EInitialState.CIRCLE,shading:a.EShading.COLORSCALE},4:{aFeeding:.049,aDiffuse:.21,bKilling:.061,bDiffuse:.105,speed:40,zoom:1,initialState:a.EInitialState.CIRCLE,shading:a.EShading.GREYSCALE},5:{aFeeding:.041,aDiffuse:.21,bKilling:.059,bDiffuse:.13,speed:80,zoom:1,initialState:a.EInitialState.DISC,shading:a.EShading.COLORSCALE},6:{aFeeding:.022,aDiffuse:.21,bKilling:.049,bDiffuse:.105,speed:10,zoom:1,initialState:a.EInitialState.CIRCLE,shading:a.EShading.GREYSCALE}};t.Presets=i},645:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageTexture=void 0;var s=r(753),o=n(r(268)),u=function(){var e=128;try{return new ImageData(new Uint8ClampedArray([e,e,e,e]),1,1)}catch(a){console.log("Failed to create default ImageData from constructor, using Canvas2D instead...");for(var t=document.createElement("canvas").getContext("2d").createImageData(1,1),r=0;r<t.data.length;r++)t.data[r]=e;return t}}(),l=function(){function e(e){this._width=-1,this._height=-1,this.id=s.gl.createTexture(),this.uploadToGPU(null!=e?e:u)}return e.prototype.loadFromUrl=function(e){var t=this;e=e+"?v="+Page.version,o.registerLoadingObject(e);var r=new Image;r.addEventListener("load",(function(){o.registerLoadedObject(e),t.uploadToGPU(r)})),r.src=e},e.prototype.uploadToGPU=function(e){this._width=e.width,this._height=e.height,s.gl.bindTexture(s.gl.TEXTURE_2D,this.id),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_WRAP_S,s.gl.CLAMP_TO_EDGE),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_WRAP_T,s.gl.CLAMP_TO_EDGE),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_MIN_FILTER,s.gl.LINEAR),s.gl.texParameteri(s.gl.TEXTURE_2D,s.gl.TEXTURE_MAG_FILTER,s.gl.LINEAR),s.gl.texImage2D(s.gl.TEXTURE_2D,0,s.gl.RGBA,s.gl.RGBA,s.gl.UNSIGNED_BYTE,e),s.gl.bindTexture(s.gl.TEXTURE_2D,null)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}();t.ImageTexture=l},489:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RenderToTextureSwapable=void 0;var a=r(991),i=function(){function e(){this.previousTexture=new a.RenderToTexture,this.currentTexture=new a.RenderToTexture}return Object.defineProperty(e.prototype,"previous",{get:function(){return this.previousTexture.texture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.currentTexture.texture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFramebuffer",{get:function(){return this.currentTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.previousTexture.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.previousTexture.height},enumerable:!1,configurable:!0}),e.prototype.reserveSpace=function(e,t){this.previousTexture.reserveSpace(e,t),this.currentTexture.reserveSpace(e,t)},e.prototype.swap=function(){var e=this.currentTexture;this.currentTexture=this.previousTexture,this.previousTexture=e},e}();t.RenderToTextureSwapable=i},991:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RenderToTexture=void 0;var a=r(753),i=function(){function e(){this.texture=a.gl.createTexture(),this.framebuffer=a.gl.createFramebuffer(),this._width=-1,this._height=-1}return e.prototype.reserveSpace=function(e,t){if(e=Math.ceil(e),t=Math.ceil(t),this.width!==e||this.height!==t){a.gl.bindTexture(a.gl.TEXTURE_2D,this.texture);var r=a.gl.RGBA;a.gl.texImage2D(a.gl.TEXTURE_2D,0,r,e,t,0,r,a.gl.UNSIGNED_BYTE,null),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MAG_FILTER,a.gl.LINEAR),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MIN_FILTER,a.gl.LINEAR),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_S,a.gl.CLAMP_TO_EDGE),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_T,a.gl.CLAMP_TO_EDGE),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,this.framebuffer),a.gl.framebufferTexture2D(a.gl.FRAMEBUFFER,a.gl.COLOR_ATTACHMENT0,a.gl.TEXTURE_2D,this.texture,0),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,null),a.gl.bindTexture(a.gl.TEXTURE_2D,null),this._width=e,this._height=t}},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}();t.RenderToTexture=i},336:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Visor=void 0;var a,i=r(852),n=r(689),s=r(61);r(457),function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(a||(a={}));var o=function(){function e(){var t=Page.Canvas.getCanvasContainer();this.horizontalLine=e.createBar(a.HORIZONTAL,"B killing rate"),t.appendChild(this.horizontalLine.container),this.verticalLine=e.createBar(a.VERTICAL,"A feeding rate"),t.appendChild(this.verticalLine.container),Page.Canvas.getCanvas().addEventListener("click",(function(){if(s.Parameters.parametersMap===n.EParametersMap.VALUE_PICKING){var t=Page.Canvas.getMousePosition();s.Parameters.AFeedingRate=e.aimedFeedA(t),s.Parameters.BKillingRate=e.aimedKillB(t),s.Parameters.exitValuePickingMode()}}))}return e.prototype.update=function(){var t=Page.Canvas.getMousePosition(),r=s.Parameters.parametersMap===n.EParametersMap.VALUE_PICKING&&e.isInRange(0,1,t[0])&&e.isInRange(0,1,t[1]);if(r){this.horizontalLine.legendValue.textContent=e.toString(e.aimedKillB(t),5),this.verticalLine.legendValue.textContent=e.toString(e.aimedFeedA(t),5);var a,i=Page.Canvas.getSize(),o=Math.round(t[0]*i[0]),u=Math.round(t[1]*i[1]);this.horizontalLine.container.style.left=o+"px",o-.5*(a=this.horizontalLine.legendContainer.getBoundingClientRect().width)<0?this.horizontalLine.legendContainer.style.left=.5*a-o+"px":o+.5*a>i[0]?this.horizontalLine.legendContainer.style.left=i[0]-(o+.5*a)+"px":this.horizontalLine.legendContainer.style.left="",this.verticalLine.container.style.top=u+"px",u-.5*(a=this.verticalLine.legendContainer.getBoundingClientRect().height)<0?this.verticalLine.legendContainer.style.top=.5*a-u+"px":u+.5*a>i[1]?this.verticalLine.legendContainer.style.top=i[1]-(u+.5*a)+"px":this.verticalLine.legendContainer.style.top=""}var l=r?"":"none";this.horizontalLine.container.style.display=l,this.verticalLine.container.style.display=l},e.aimedFeedA=function(t){var r=.5+(e.clamp(0,1,1-t[1])-.5)/s.Parameters.zoom;return e.interpolate(i.Engine.A_FEEDING_MIN,i.Engine.A_FEEDING_MAX,r)},e.aimedKillB=function(t){var r=.5+(e.clamp(0,1,t[0])-.5)/s.Parameters.zoom;return e.interpolate(i.Engine.B_KILLING_MIN,i.Engine.B_KILLING_MAX,r)},e.createBar=function(e,t){var r=document.createElement("div");r.classList.add("visor-bar"),r.classList.add(e),r.style.display="none";var a=document.createElement("div");a.classList.add("visor-bar-legend");var i=document.createElement("span");i.textContent=t,a.appendChild(i),a.appendChild(document.createElement("br"));var n=document.createElement("span");return n.textContent="?",a.appendChild(n),r.appendChild(a),{container:r,legendContainer:a,legendValue:n}},e.clamp=function(e,t,r){return r<e?e:r>t?t:r},e.interpolate=function(e,t,r){return t*r+e*(1-r)},e.isInRange=function(e,t,r){return e<=r&&r<=t},e.toString=function(e,t){var r=e.toString(),a=r.indexOf(".");if(a<0)return r;var i=Math.min(t,r.length-(a+1));return r.substring(0,a+1+i)},e}();t.Visor=o}},t={};!function r(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,r),n.exports}(633)}();
//# sourceMappingURL=main.min.js.map
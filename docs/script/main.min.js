!function(){"use strict";var e={852:function(e,t,a){var r=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&r(t,e,a);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;var o=a(689),s=a(753),u=n(a(748)),l=a(62),d=n(a(350)),c=n(a(268)),g=a(61),h=a(645),f=a(489);function p(e,t,a){return e<=a&&a<=t}var b=function(){function e(){var t=this;this.lastUpdateTimestamp=0,this.targetWidth=1,this.targetHeight=1,this.squareVBO=l.VBO.createQuad(s.gl,-1,-1,1,1),this.greyscaleTexture=new h.ImageTexture,this.greyscaleTexture.loadFromUrl("./resources/greyscale.png"),this.colorscaleTexture=new h.ImageTexture,this.colorscaleTexture.loadFromUrl("./resources/colorscale.png"),this.internalTextures=[new f.RenderToTextureSwapable,new f.RenderToTextureSwapable,new f.RenderToTextureSwapable],this.needToReset=!0,this.lastIterationUpdate=performance.now()-5e3,this.iteration=0,this.asyncLoadShader("display-monochrome","display/display.vert","display/display-monochrome.frag",(function(e){t.displayMonochromeShader=e})),this.asyncLoadShader("display-tricolor","display/display.vert","display/display-tricolor.frag",(function(e){t.displayTricolorShader=e})),this.asyncLoadShader("display-ramp","display/display.vert","display/display-ramp.frag",(function(e){t.displayRampShader=e})),this.asyncLoadShader("update-uniform","update/update.vert","update/update-uniform.frag",(function(e){t.updateUniformShader=e})),this.asyncLoadShader("update-map","update/update.vert","update/update-map.frag",(function(e){t.updateMapShader=e}),{A_FEEDING_MIN:e.A_FEEDING_MIN.toFixed(5),A_FEEDING_MAX:e.A_FEEDING_MAX.toFixed(5),B_KILLING_MIN:e.B_KILLING_MIN.toFixed(5),B_KILLING_MAX:e.B_KILLING_MAX.toFixed(5)}),this.asyncLoadShader("update-image","update/update.vert","update/update-map-image.frag",(function(e){t.updateImageMapShader=e})),this.asyncLoadShader("reset","update/update.vert","update/reset.frag",(function(e){t.resetShader=e})),this.asyncLoadShader("brush-apply","update/brush.vert","update/brush-apply.frag",(function(e){t.brushApplyShader=e})),this.asyncLoadShader("brush-display","update/brush.vert","update/brush-display.frag",(function(e){t.brushDisplayShader=e}))}return e.prototype.resize=function(e,t){this.targetWidth=e,this.targetHeight=t},e.prototype.reset=function(){this.needToReset=!0},e.prototype.drawToCanvas=function(){var e;s.gl.viewport(0,0,this.targetWidth,this.targetHeight);var t=g.Parameters.displayMode;if(t===o.EDisplayMode.MONOCHROME){var a=g.Parameters.shading;a===o.EShading.BINARY?this.displayMonochromeShader&&(this.displayMonochromeShader.u.uTexture.value=this.internalTextures[0].current,e=this.displayMonochromeShader):this.displayRampShader&&(this.displayRampShader.u.uTexture.value=this.internalTextures[0].current,a===o.EShading.GREYSCALE?this.displayRampShader.u.uRamp.value=this.greyscaleTexture.id:this.displayRampShader.u.uRamp.value=this.colorscaleTexture.id,e=this.displayRampShader)}else t===o.EDisplayMode.TRICOLOR&&this.displayTricolorShader&&(this.displayTricolorShader.u.uTextureRed.value=this.internalTextures[0].current,this.displayTricolorShader.u.uTextureGreen.value=this.internalTextures[1].current,this.displayTricolorShader.u.uTextureBlue.value=this.internalTextures[2].current,e=this.displayTricolorShader);if(e){if(g.Parameters.parametersMap===o.EParametersMap.IMAGE){var r=this.targetWidth/this.targetHeight,i=this.internalTextures[0].width/this.internalTextures[0].height;e.u.uScaling.value=r>i?[i/r,1]:[1,r/i]}else e.u.uScaling.value=[1,1];e.u.uZoom.value=g.Parameters.zoom,s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,null),e.use(),e.bindUniformsAndAttributes(),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4)}},e.prototype.update=function(){if(this.adjustInternalTextureSize()&&(this.needToReset=!0),s.gl.viewport(0,0,this.internalTextures[0].width,this.internalTextures[0].height),this.needToReset){if(this.iteration=0,!this.clearInternalTextures())return;this.needToReset=!1}this.handleBrush();var e=this.computeNbIterationsForThisFrame();if(!(e<=0)){var t=g.Parameters.parametersMap;if(t===o.EParametersMap.IMAGE){if(this.updateImageMapShader){var a=d.getTexture();if(this.updateImageMapShader.u.uImageMapTexture.value=a.id,this.updateImageMapShader.u.uDiffuseScaling.value=g.Parameters.patternsScale,this.updateImageMapShader.u.uTexelSize.value=[1/this.internalTextures[0].width,1/this.internalTextures[0].height],this.updateImageMapShader.use(),this.updateImageMapShader.bindAttributes(),g.Parameters.displayMode===o.EDisplayMode.MONOCHROME)this.updateImageMapShader.u.uSampledChannel.value=[0,0,0,1],this.updateInternal(this.updateImageMapShader,e,this.internalTextures[0]);else{var r=Math.ceil(e/3);this.updateImageMapShader.u.uSampledChannel.value=[1,0,0,0],this.updateInternal(this.updateImageMapShader,r,this.internalTextures[0]),this.updateImageMapShader.u.uSampledChannel.value=[0,1,0,0],this.updateInternal(this.updateImageMapShader,r,this.internalTextures[1]),this.updateImageMapShader.u.uSampledChannel.value=[0,0,1,0],this.updateInternal(this.updateImageMapShader,r,this.internalTextures[2])}}}else{var i=void 0;t===o.EParametersMap.UNIFORM?this.updateUniformShader&&(this.updateUniformShader.u.uRates.value=[g.Parameters.AFeedingRate,g.Parameters.BKillingRate,g.Parameters.ADiffusionRate,g.Parameters.BDIffusionRate],i=this.updateUniformShader):t===o.EParametersMap.VALUE_PICKING&&this.updateMapShader&&(this.updateMapShader.u.uRates.value=[g.Parameters.ADiffusionRate,g.Parameters.BDIffusionRate],i=this.updateMapShader),i&&(i.use(),i.bindAttributes(),i.u.uTexelSize.value=[1/this.internalTextures[0].width,1/this.internalTextures[0].height],this.updateInternal(i,e,this.internalTextures[0]))}}},e.prototype.updateInternal=function(e,t,a){for(var r=t;r>0;r--)a.swap(),s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,a.currentFramebuffer),e.u.uPreviousIteration.value=a.previous,e.bindUniforms(),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4);this.iteration=this._iteration+t},e.prototype.displayBrush=function(){if(g.Parameters.parametersMap!==o.EParametersMap.VALUE_PICKING&&this.brushDisplayShader){var e=g.Parameters.brushSize,t=Page.Canvas.getMousePosition();this.brushDisplayShader.u.uPosition.value=[2*(t[0]-.5),-2*(t[1]-.5)],this.brushDisplayShader.u.uSize.value=[e/this.targetWidth,e/this.targetHeight],s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,null),this.brushDisplayShader.use(),this.brushDisplayShader.bindUniformsAndAttributes(),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4)}},e.prototype.handleBrush=function(){var e=g.Parameters.parametersMap;if(e!==o.EParametersMap.VALUE_PICKING&&this.brushApplyShader&&Page.Canvas.isMouseDown()){var t=Page.Canvas.getMousePosition();if(p(0,1,t[0])&&p(0,1,t[1])){var a=g.Parameters.brushSize,r=g.Parameters.zoom,i=[2*(t[0]-.5)/r,-2*(t[1]-.5)/r];if(e===o.EParametersMap.IMAGE){var n=this.targetWidth/this.targetHeight,u=this.internalTextures[0].width/this.internalTextures[0].height;n>u?i[0]*=n/u:n<u&&(i[1]*=u/n)}this.brushApplyShader.u.uPosition.value=i,this.brushApplyShader.u.uSize.value=[a/this.internalTextures[0].width/r,a/this.internalTextures[0].height/r],this.brushApplyShader.use(),this.brushApplyShader.bindUniformsAndAttributes();for(var l=0,d=this.internalTextures;l<d.length;l++){var c=d[l];s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,c.currentFramebuffer),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4)}}}},e.prototype.clearInternalTextures=function(){if(this.resetShader){var e=g.Parameters.initialState;this.resetShader.u.uPattern.value=[e===o.EInitialState.BLANK,e===o.EInitialState.DISC,e===o.EInitialState.CIRCLE,0],this.resetShader.use(),this.resetShader.bindUniformsAndAttributes();for(var t=0,a=this.internalTextures;t<a.length;t++){var r=a[t];s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,r.currentFramebuffer),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4)}return!0}return!1},e.prototype.adjustInternalTextureSize=function(){var e=this.targetWidth,t=this.targetHeight;if(g.Parameters.parametersMap===o.EParametersMap.IMAGE){var a=this.targetWidth/this.targetHeight,r=d.getTexture().width/d.getTexture().height;a>r?e=Math.ceil(r/a*this.targetWidth):a<r&&(t=Math.ceil(a/r*this.targetHeight))}if(this.internalTextures[0].width!==e||this.internalTextures[0].height!==t){for(var i=0,n=this.internalTextures;i<n.length;i++)n[i].reserveSpace(e,t);return!0}return!1},Object.defineProperty(e.prototype,"iteration",{set:function(e){this._iteration=e;var t=performance.now();t-this.lastIterationUpdate>200&&(Page.Canvas.setIndicatorText("iteration-indicator",this._iteration.toString()),this.lastIterationUpdate=t)},enumerable:!1,configurable:!0}),e.prototype.computeNbIterationsForThisFrame=function(){var e=g.Parameters.speed,t=performance.now(),a=1e3/(.1+t-this.lastUpdateTimestamp);return this.lastUpdateTimestamp=t,a>60?Math.ceil(60/a*e):a<10?Math.ceil(a/10*e):e},e.prototype.asyncLoadShader=function(e,t,a,r,i){var n=this;void 0===i&&(i={});var o="shader-".concat(e);c.registerLoadingObject(o),u.buildShader({fragmentFilename:a,vertexFilename:t,injected:i},(function(t){c.registerLoadedObject(o),null!==t?(t.a.aCorner.VBO=n.squareVBO,r(t)):Page.Demopage.setErrorMessage("".concat(e,"-shader-error"),"Failed to build '".concat(e,"' shader."))}))},e.A_FEEDING_MIN=.01,e.A_FEEDING_MAX=.1,e.B_KILLING_MIN=.045,e.B_KILLING_MAX=.07,e}();t.Engine=b},689:function(e,t){var a,r,i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.EParametersMap=t.EShading=t.EInitialState=t.EDisplayMode=void 0,function(e){e.UNIFORM="uniform",e.VALUE_PICKING="value_picking",e.IMAGE="image"}(a||(a={})),t.EParametersMap=a,function(e){e.BLANK="blank",e.DISC="disc",e.CIRCLE="circle"}(r||(r={})),t.EInitialState=r,function(e){e.MONOCHROME="monochrome",e.TRICOLOR="tricolor"}(i||(i={})),t.EDisplayMode=i,function(e){e.BINARY="binary",e.GREYSCALE="greyscale",e.COLORSCALE="colorscale"}(n||(n={})),t.EShading=n},667:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.registerFrame=void 0,a(457);var r=0,i=performance.now();setInterval((function(){var e=performance.now(),t=1e3*r/(e-i);i=e,r=0,Page.Canvas.setIndicatorText("fps-indicator",Math.round(t).toString())}),500),t.registerFrame=function(){r++}},753:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.gl=t.initGL=t.adjustSize=void 0,a(457);var r=null;t.gl=r,t.initGL=function(e){function a(e){Page.Demopage.setErrorMessage("webgl-support",e)}var i=Page.Canvas.getCanvas();if(t.gl=r=i.getContext("webgl",e),null==r){if(t.gl=r=i.getContext("experimental-webgl",e),null==r)return a("Your browser or device does not seem to support WebGL."),!1;a("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.BLEND),r.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,a=r.canvas,i=Math.floor(a.clientWidth*t),n=Math.floor(a.clientHeight*t);a.width===i&&a.height===n||(a.width=i,a.height=n)}},771:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GLResource=void 0;var a=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.GLResource=a},748:function(e,t,a){var r=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&r(t,e,a);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteShader=t.registerShader=t.getShader=t.buildShader=void 0;var o=a(753),s=a(490),u=n(a(71)),l={};function d(e,t){var a=2,r=0;function i(i){function n(t){return t.replace(/#INJECT\(([^)]*)\)/gm,(function(t,a){return e.injected[a]?e.injected[a]:t}))}if(a--,i||r++,0===a){var l=null;if(0===r){var d=u.getSource(e.vertexFilename),c=u.getSource(e.fragmentFilename),g=n(d),h=n(c);l=new s.Shader(o.gl,g,h)}t(l)}}u.loadSource(e.vertexFilename,i),u.loadSource(e.fragmentFilename,i)}t.getShader=function(e){return l[e].shader},t.buildShader=d,t.registerShader=function(e,t,a){function r(e){for(var t=0,a=e.callbacks;t<a.length;t++)(0,a[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===l[e]){l[e]={callbacks:[a],failed:!1,infos:t,pending:!0,shader:null};var i=l[e];d(t,(function(e){i.pending=!1,i.failed=null===e,i.shader=e,r(i)}))}else{var n=l[e];!0===n.pending?n.callbacks.push(a):r(n)}},t.deleteShader=function(e){void 0!==l[e]&&(null!==l[e].shader&&l[e].shader.freeGLResources(),delete l[e])}},71:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loadSource=t.getSource=void 0;var a={};t.loadSource=function(e,t){function r(e){for(var t=0,a=e.callbacks;t<a.length;t++)(0,a[t])(!e.failed);e.callbacks=[]}if(void 0===a[e]){a[e]={callbacks:[t],failed:!1,pending:!0,text:null};var i=a[e],n="./shaders/"+e;void 0!==Page.version&&(n+="?v=".concat(Page.version));var o=new XMLHttpRequest;o.open("GET",n,!0),o.onload=function(){4===o.readyState&&(i.pending=!1,200===o.status?(i.text=o.responseText,i.failed=!1):(console.error("Cannot load '".concat(e,"' shader source: ").concat(o.statusText)),i.failed=!0),r(i))},o.onerror=function(){console.error("Cannot load '".concat(e,"' shader source: ").concat(o.statusText)),i.pending=!1,i.failed=!0,r(i)},o.send(null)}else{var s=a[e];!0===s.pending?s.callbacks.push(t):(s.callbacks=[t],r(s))}},t.getSource=function(e){return a[e].text}},490:function(e,t,a){var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;var n=a(771);function o(){alert("NOT IMPLEMENTED YET")}var s={35664:{str:"FLOAT_VEC2",binder:function(e,t,a){e.uniform2fv(t,a)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,a){e.uniform3fv(t,a)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,a){e.uniform4fv(t,a)}},35667:{str:"INT_VEC2",binder:function(e,t,a){e.uniform2iv(t,a)}},35668:{str:"INT_VEC3",binder:function(e,t,a){e.uniform3iv(t,a)}},35669:{str:"INT_VEC4",binder:function(e,t,a){e.uniform4iv(t,a)}},35670:{str:"BOOL",binder:function(e,t,a){e.uniform1i(t,+a)}},35671:{str:"BOOL_VEC2",binder:function(e,t,a){e.uniform2iv(t,a)}},35672:{str:"BOOL_VEC3",binder:function(e,t,a){e.uniform3iv(t,a)}},35673:{str:"BOOL_VEC4",binder:function(e,t,a){e.uniform4iv(t,a)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,a){e.uniformMatrix2fv(t,!1,a)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,a){e.uniformMatrix3fv(t,!1,a)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,a){e.uniformMatrix4fv(t,!1,a)}},35678:{str:"SAMPLER_2D",binder:function(e,t,a,r){e.uniform1i(t,a),e.activeTexture(e["TEXTURE"+a]),e.bindTexture(e.TEXTURE_2D,r)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,a,r){e.uniform1i(t,a),e.activeTexture(e["TEXTURE"+a]),e.bindTexture(e.TEXTURE_CUBE_MAP,r)}},5120:{str:"BYTE",binder:o},5121:{str:"UNSIGNED_BYTE",binder:o},5122:{str:"SHORT",binder:o},5123:{str:"UNSIGNED_SHORT",binder:o},5124:{str:"INT",binder:function(e,t,a){Array.isArray(a),e.uniform1iv(t,a)}},5125:{str:"UNSIGNED_INT",binder:o},5126:{str:"FLOAT",binder:function(e,t,a){Array.isArray(a)?e.uniform1fv(t,a):e.uniform1f(t,a)}}},u=function(e){function t(t,a,r){var i=this;function n(e,a){var r=t.createShader(e);return t.shaderSource(r,a),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error(t.getShaderInfoLog(r)),console.log(a),t.deleteShader(r),null)}(i=e.call(this,t)||this).id=null,i.uCount=0,i.aCount=0;var o=n(t.VERTEX_SHADER,a),s=n(t.FRAGMENT_SHADER,r),u=t.createProgram();return t.attachShader(u,o),t.attachShader(u,s),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)?(i.id=u,i.introspection()):(console.error(t.getProgramInfoLog(u)),t.deleteProgram(u)),i}return i(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,a=e.prototype.gl.call(this),r=0;Object.keys(this.u).forEach((function(e){var i=t.u[e];if(null!==i.value)if(35678===i.type||35680===i.type){var n=r;s[i.type].binder(a,i.loc,n,i.value),r++}else s[i.type].binder(a,i.loc,i.value)}))},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach((function(t){var a=e.a[t];null!==a.VBO&&a.VBO.bind(a.loc)}))},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u={};for(var a=0;a<this.uCount;a++){var r=t.getActiveUniform(this.id,a),i=r.name;this.u[i]={loc:t.getUniformLocation(this.id,i),size:r.size,type:r.type,value:null}}for(this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a={},a=0;a<this.aCount;a++){var n=t.getActiveAttrib(this.id,a),o=n.name;this.a[o]={VBO:null,loc:t.getAttribLocation(this.id,o),size:n.size,type:n.type}}},t}(n.GLResource);t.Shader=u},62:function(e,t,a){var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)});Object.defineProperty(t,"__esModule",{value:!0}),t.VBO=void 0;var n,o=a(771);!function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.STATIC=1]="STATIC"}(n||(n={}));var s=function(e){function t(t,a,r,i,o){void 0===o&&(o=!0);var s=e.call(this,t)||this;return s.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s.id),o?t.bufferData(t.ARRAY_BUFFER,a,t.STATIC_DRAW):t.bufferData(t.ARRAY_BUFFER,a,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),s.size=r,s.type=i,s.normalize=!1,s.stride=0,s.offset=0,s.usage=o?n.STATIC:n.DYNAMIC,s}return i(t,e),t.createQuad=function(e,a,r,i,n){return new t(e,new Float32Array([a,r,i,r,a,n,i,n]),2,e.FLOAT,!0)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var a=e.prototype.gl.call(this);a.enableVertexAttribArray(t),a.bindBuffer(a.ARRAY_BUFFER,this.id),a.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t.prototype.setData=function(t){var a=e.prototype.gl.call(this);a.bindBuffer(a.ARRAY_BUFFER,this.id),this.usage===n.STATIC?a.bufferData(a.ARRAY_BUFFER,t,a.STATIC_DRAW):a.bufferData(a.ARRAY_BUFFER,t,a.DYNAMIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,null)},t}(o.GLResource);t.VBO=s},350:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.getTexture=void 0;var r,i=a(61),n=a(645),o=document.createElement("canvas"),s=o.getContext("2d"),u=null;function l(e,t,a){return.21*e+.72*t+.07*a}i.Parameters.imageUploadObservers.push((function(e){r=function(e){var t=Math.min(1,512/Math.max(e.width,e.height)),a=Math.ceil(t*e.width),r=Math.ceil(t*e.height);o.width=a,o.height=r,s.drawImage(e,0,0,a,r);for(var i=s.getImageData(0,0,o.width,o.height),n=new Uint8ClampedArray(i.data),u=0,d=i.height-1;d>=0;d--)for(var c=0;c<i.width;c++){var g=n[4*(c+d*i.width)],h=n[4*(c+d*i.width)+1],f=n[4*(c+d*i.width)+2],p=l(g,h,f);i.data[u++]=g,i.data[u++]=h,i.data[u++]=f,i.data[u++]=p}return i}(e),null!==u&&u.uploadToGPU(r)})),t.getTexture=function(){return null===u&&(u=new n.ImageTexture(r)),u}},268:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.registerLoadingObject=t.registerLoadedObject=void 0,a(457);var r={};t.registerLoadingObject=function(e){0===Object.keys(r).length&&Page.Canvas.showLoader(!0),r[e]=!1},t.registerLoadedObject=function(e){delete r[e],0===Object.keys(r).length&&Page.Canvas.showLoader(!1)}},633:function(e,t,a){var r=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&r(t,e,a);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var o=a(852),s=n(a(667)),u=n(a(753)),l=a(753),d=a(61),c=a(336);function g(e){var t=d.Parameters.blur;e.style.filter=t<=0?"":"blur(".concat(t,"px)")}a(457),function(){if(u.initGL({alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!1})){l.gl.disable(l.gl.CULL_FACE),l.gl.disable(l.gl.BLEND),l.gl.disable(l.gl.DEPTH_TEST),l.gl.disable(l.gl.STENCIL_TEST);var e=Page.Canvas.getCanvas();d.Parameters.blurChangeObservers.push((function(){g(e)})),g(e);var t=!0;d.Parameters.canvasResizeObservers.push((function(){t=!0}));var a=!0;d.Parameters.resetObservers.push((function(){a=!0}));var r=!1;d.Parameters.imageDownloadObservers.push((function(){r=!0}));var i=new o.Engine,n=new c.Visor;!function o(){s.registerFrame(),r&&(i.drawToCanvas(),function(e){var t="reaction-diffusion.png";if(e.msToBlob){var a=e.msToBlob();window.navigator.msSaveBlob(a,t)}else e.toBlob((function(e){var a=document.createElement("a");a.download=t,a.href=URL.createObjectURL(e),a.click()}))}(e),r=!1),t&&(u.adjustSize(!1),i.resize(e.width,e.height),t=!1),a&&(i.reset(),a=!1),i.update(),i.drawToCanvas(),n.update(),d.Parameters.displayBrush&&i.displayBrush(),requestAnimationFrame(o)}()}}()},457:function(){},61:function(e,t,a){var r=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&r(t,e,a);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=void 0;var o=a(689),s=n(a(268)),u=a(470);a(457);var l="map-tabs-id",d="presets-fixed-select-id",c="input-image-upload-button",g="pattern-scale-range-id",h="A-feeding-range-id",f="A-diffusion-range-id",p="B-killing-range-id",b="B-diffusion-range-id",v="pick-values-button-id",m="speed-range-id",E="initial-state-tabs-id",P="display-mode-tabs-id",T="shading-tabs-id",y="zoom-range-id",S="blur-range-id",R="indicators-checkbox-id";function _(e){for(var t=0,a=e;t<a.length;t++)(0,a[t])()}var I=!1,M=function(){var e=A.parametersMap,t=A.displayMode;Page.Controls.setVisibility(d,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(h,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(p,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(v,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(g,e===o.EParametersMap.IMAGE),Page.Controls.setVisibility(f,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(b,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(c,e===o.EParametersMap.IMAGE),Page.Controls.setVisibility(P,e===o.EParametersMap.IMAGE),Page.Controls.setVisibility(T,t===o.EDisplayMode.MONOCHROME)};function O(){Page.Select.setValue(d,null)}Page.Range.addObserver(h,O),Page.Range.addObserver(f,O),Page.Range.addObserver(p,O),Page.Range.addObserver(b,O);var A=function(){function e(){}return Object.defineProperty(e,"parametersMap",{get:function(){return I?o.EParametersMap.VALUE_PICKING:Page.Tabs.getValues(l)[0]},enumerable:!1,configurable:!0}),e.exitValuePickingMode=function(){I=!1,Page.Tabs.setValues(l,[o.EParametersMap.UNIFORM]),M()},Object.defineProperty(e,"patternsScale",{get:function(){return Page.Range.getValue(g)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"AFeedingRate",{get:function(){return Page.Range.getValue(h)},set:function(e){Page.Range.setValue(h,e),Page.Range.storeState(h),O()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ADiffusionRate",{get:function(){return Page.Range.getValue(f)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BKillingRate",{get:function(){return Page.Range.getValue(p)},set:function(e){Page.Range.setValue(p,e),Page.Range.storeState(p),O()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BDIffusionRate",{get:function(){return Page.Range.getValue(b)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"speed",{get:function(){return Page.Range.getValue(m)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"brushSize",{get:function(){return Page.Range.getValue("brush-size-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayBrush",{get:function(){return!I&&Page.Checkbox.isChecked("brush-display-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"initialState",{get:function(){return I?o.EInitialState.CIRCLE:Page.Tabs.getValues(E)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"zoom",{get:function(){return Page.Range.getValue(y)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"blur",{get:function(){return Page.Range.getValue(S)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayMode",{get:function(){return e.parametersMap===o.EParametersMap.IMAGE?Page.Tabs.getValues(P)[0]:o.EDisplayMode.MONOCHROME},enumerable:!1,configurable:!0}),Object.defineProperty(e,"shading",{get:function(){return Page.Tabs.getValues(T)[0]},enumerable:!1,configurable:!0}),e.imageUploadObservers=[],e.imageDownloadObservers=[],e.canvasResizeObservers=[],e.resetObservers=[],e.blurChangeObservers=[],e}();t.Parameters=A,Page.Canvas.Observers.canvasResize.push((function(){_(A.canvasResizeObservers)}));var C=function(){_(A.resetObservers)};Page.Select.addObserver(d,C),Page.Button.addObserver("reset-button-id",C),Page.Tabs.addObserver(l,C),Page.Tabs.addObserver(P,C),Page.Tabs.addObserver(E,C),A.imageUploadObservers.push(C),Page.Tabs.addObserver(l,(function(){I=!1,M(),A.parametersMap===o.EParametersMap.IMAGE&&(Page.Range.setValue(y,1),Page.Range.setValue(m,40),Page.Tabs.setValues(E,[o.EInitialState.CIRCLE]),Page.Tabs.setValues(T,[o.EShading.BINARY]),Page.Range.clearStoredState(y),Page.Range.clearStoredState(m),Page.Tabs.clearStoredState(E),Page.Tabs.clearStoredState(T),Page.Select.clearStoredState(d))})),Page.Tabs.addObserver(P,M),M();var x=function(){Page.Canvas.setIndicatorsVisibility(Page.Checkbox.isChecked(R))};Page.Checkbox.addObserver(R,x),x(),Page.Button.addObserver(v,(function(){Page.Tabs.setValues(l,[]),I=!0,Page.Range.setValue(f,.2097),Page.Range.setValue(b,.105),Page.Range.setValue(y,1),A.speed<30&&Page.Range.setValue(m,30),O(),M(),C()})),Page.Range.addObserver(S,(function(){_(A.blurChangeObservers)})),Page.FileControl.addUploadObserver(c,(function(e){if(1===e.length){var t=new FileReader;t.onload=function(){var e=new Image;e.addEventListener("load",(function(){for(var t=0,a=A.imageUploadObservers;t<a.length;t++)(0,a[t])(e)})),e.src=t.result},t.readAsDataURL(e[0])}}));var L="./resources/cat.jpg?v=".concat(Page.version);s.registerLoadingObject(L);var F=new Image;function D(){if(A.parametersMap===o.EParametersMap.UNIFORM){var e=Page.Select.getValue(d),t=u.Presets[e];t&&(Page.Range.setValue(h,t.aFeeding),Page.Range.setValue(f,t.aDiffuse),Page.Range.setValue(p,t.bKilling),Page.Range.setValue(b,t.bDiffuse),Page.Range.setValue(m,t.speed),Page.Range.setValue(y,t.zoom),Page.Tabs.setValues(E,[t.initialState]),Page.Tabs.setValues(T,[t.shading]),Page.Range.clearStoredState(h),Page.Range.clearStoredState(f),Page.Range.clearStoredState(p),Page.Range.clearStoredState(b),Page.Range.clearStoredState(m),Page.Range.clearStoredState(y),Page.Tabs.clearStoredState(E),Page.Tabs.clearStoredState(T))}}F.addEventListener("load",(function(){s.registerLoadedObject(L);for(var e=0,t=A.imageUploadObservers;e<t.length;e++)(0,t[e])(F)})),F.src=L,Page.FileControl.addDownloadObserver("image-download-id",(function(){_(A.imageDownloadObservers)})),Page.Select.addObserver(d,(function(){A.exitValuePickingMode(),D()})),Page.Tabs.addObserver(l,D),D(),Page.Canvas.Observers.mouseDrag.push((function(){}))},470:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.Presets=void 0;var r=a(689),i={0:{aFeeding:.015,aDiffuse:.21,bKilling:.049,bDiffuse:.105,speed:8,zoom:3,initialState:r.EInitialState.DISC,shading:r.EShading.COLORSCALE},1:{aFeeding:.037,aDiffuse:.5,bKilling:.059,bDiffuse:.342,speed:100,zoom:1,initialState:r.EInitialState.CIRCLE,shading:r.EShading.BINARY},2:{aFeeding:.058,aDiffuse:.21,bKilling:.063,bDiffuse:.105,speed:60,zoom:1,initialState:r.EInitialState.CIRCLE,shading:r.EShading.GREYSCALE},3:{aFeeding:.021,aDiffuse:.21,bKilling:.056,bDiffuse:.105,speed:10,zoom:2,initialState:r.EInitialState.CIRCLE,shading:r.EShading.COLORSCALE},4:{aFeeding:.049,aDiffuse:.21,bKilling:.061,bDiffuse:.105,speed:40,zoom:1,initialState:r.EInitialState.CIRCLE,shading:r.EShading.GREYSCALE},5:{aFeeding:.041,aDiffuse:.21,bKilling:.059,bDiffuse:.13,speed:80,zoom:1,initialState:r.EInitialState.DISC,shading:r.EShading.COLORSCALE},6:{aFeeding:.022,aDiffuse:.21,bKilling:.049,bDiffuse:.105,speed:10,zoom:1,initialState:r.EInitialState.CIRCLE,shading:r.EShading.GREYSCALE}};t.Presets=i},645:function(e,t,a){var r=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&r(t,e,a);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageTexture=void 0;var o=a(753),s=n(a(268)),u=function(){try{return new ImageData(new Uint8ClampedArray([0,0,0,0]),1,1)}catch(a){console.log("Failed to create default ImageData from constructor, using Canvas2D instead...");for(var e=document.createElement("canvas").getContext("2d").createImageData(1,1),t=0;t<e.data.length;t++)e.data[t]=0;return e}}(),l=function(){function e(e){this._width=-1,this._height=-1,this.id=o.gl.createTexture(),this.uploadToGPU(null!=e?e:u)}return e.prototype.loadFromUrl=function(e){var t=this;e="".concat(e,"?v=").concat(Page.version),s.registerLoadingObject(e);var a=new Image;a.addEventListener("load",(function(){s.registerLoadedObject(e),t.uploadToGPU(a)})),a.src=e},e.prototype.uploadToGPU=function(e){this._width=e.width,this._height=e.height,o.gl.bindTexture(o.gl.TEXTURE_2D,this.id),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_WRAP_S,o.gl.CLAMP_TO_EDGE),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_WRAP_T,o.gl.CLAMP_TO_EDGE),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_MIN_FILTER,o.gl.LINEAR),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_MAG_FILTER,o.gl.LINEAR),o.gl.texImage2D(o.gl.TEXTURE_2D,0,o.gl.RGBA,o.gl.RGBA,o.gl.UNSIGNED_BYTE,e),o.gl.bindTexture(o.gl.TEXTURE_2D,null)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}();t.ImageTexture=l},489:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.RenderToTextureSwapable=void 0;var r=a(991),i=function(){function e(){this.previousTexture=new r.RenderToTexture,this.currentTexture=new r.RenderToTexture}return Object.defineProperty(e.prototype,"previous",{get:function(){return this.previousTexture.texture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.currentTexture.texture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFramebuffer",{get:function(){return this.currentTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.previousTexture.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.previousTexture.height},enumerable:!1,configurable:!0}),e.prototype.reserveSpace=function(e,t){this.previousTexture.reserveSpace(e,t),this.currentTexture.reserveSpace(e,t)},e.prototype.swap=function(){var e=this.currentTexture;this.currentTexture=this.previousTexture,this.previousTexture=e},e}();t.RenderToTextureSwapable=i},991:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.RenderToTexture=void 0;var r=a(753),i=function(){function e(){this.texture=r.gl.createTexture(),this.framebuffer=r.gl.createFramebuffer(),this._width=-1,this._height=-1}return e.prototype.reserveSpace=function(e,t){if(e=Math.ceil(e),t=Math.ceil(t),this.width!==e||this.height!==t){r.gl.bindTexture(r.gl.TEXTURE_2D,this.texture);var a=r.gl.RGBA;r.gl.texImage2D(r.gl.TEXTURE_2D,0,a,e,t,0,a,r.gl.UNSIGNED_BYTE,null),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MAG_FILTER,r.gl.LINEAR),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MIN_FILTER,r.gl.LINEAR),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_S,r.gl.CLAMP_TO_EDGE),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_WRAP_T,r.gl.CLAMP_TO_EDGE),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,this.framebuffer),r.gl.framebufferTexture2D(r.gl.FRAMEBUFFER,r.gl.COLOR_ATTACHMENT0,r.gl.TEXTURE_2D,this.texture,0),r.gl.bindFramebuffer(r.gl.FRAMEBUFFER,null),r.gl.bindTexture(r.gl.TEXTURE_2D,null),this._width=e,this._height=t}},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}();t.RenderToTexture=i},336:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.Visor=void 0;var r,i=a(852),n=a(689),o=a(61);a(457),function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(r||(r={}));var s=function(){function e(){var t=Page.Canvas.getCanvasContainer();this.horizontalLine=e.createBar(r.HORIZONTAL,"B killing rate"),t.appendChild(this.horizontalLine.container),this.verticalLine=e.createBar(r.VERTICAL,"A feeding rate"),t.appendChild(this.verticalLine.container),Page.Canvas.getCanvas().addEventListener("click",(function(){if(o.Parameters.parametersMap===n.EParametersMap.VALUE_PICKING){var t=Page.Canvas.getMousePosition();o.Parameters.AFeedingRate=e.aimedFeedA(t),o.Parameters.BKillingRate=e.aimedKillB(t),o.Parameters.exitValuePickingMode()}}))}return e.prototype.update=function(){var t=Page.Canvas.getMousePosition(),a=o.Parameters.parametersMap===n.EParametersMap.VALUE_PICKING&&e.isInRange(0,1,t[0])&&e.isInRange(0,1,t[1]);if(a){this.horizontalLine.legendValue.textContent=e.toString(e.aimedKillB(t),5),this.verticalLine.legendValue.textContent=e.toString(e.aimedFeedA(t),5);var r,i=Page.Canvas.getSize(),s=Math.round(t[0]*i[0]),u=Math.round(t[1]*i[1]);this.horizontalLine.container.style.left="".concat(s,"px"),s-.5*(r=this.horizontalLine.legendContainer.getBoundingClientRect().width)<0?this.horizontalLine.legendContainer.style.left="".concat(.5*r-s,"px"):s+.5*r>i[0]?this.horizontalLine.legendContainer.style.left="".concat(i[0]-(s+.5*r),"px"):this.horizontalLine.legendContainer.style.left="",this.verticalLine.container.style.top="".concat(u,"px"),u-.5*(r=this.verticalLine.legendContainer.getBoundingClientRect().height)<0?this.verticalLine.legendContainer.style.top="".concat(.5*r-u,"px"):u+.5*r>i[1]?this.verticalLine.legendContainer.style.top="".concat(i[1]-(u+.5*r),"px"):this.verticalLine.legendContainer.style.top=""}var l=a?"":"none";this.horizontalLine.container.style.display=l,this.verticalLine.container.style.display=l},e.aimedFeedA=function(t){var a=.5+(e.clamp(0,1,1-t[1])-.5)/o.Parameters.zoom;return e.interpolate(i.Engine.A_FEEDING_MIN,i.Engine.A_FEEDING_MAX,a)},e.aimedKillB=function(t){var a=.5+(e.clamp(0,1,t[0])-.5)/o.Parameters.zoom;return e.interpolate(i.Engine.B_KILLING_MIN,i.Engine.B_KILLING_MAX,a)},e.createBar=function(e,t){var a=document.createElement("div");a.classList.add("visor-bar"),a.classList.add(e),a.style.display="none";var r=document.createElement("div");r.classList.add("visor-bar-legend");var i=document.createElement("span");i.textContent=t,r.appendChild(i),r.appendChild(document.createElement("br"));var n=document.createElement("span");return n.textContent="?",r.appendChild(n),a.appendChild(r),{container:a,legendContainer:r,legendValue:n}},e.clamp=function(e,t,a){return a<e?e:a>t?t:a},e.interpolate=function(e,t,a){return t*a+e*(1-a)},e.isInRange=function(e,t,a){return e<=a&&a<=t},e.toString=function(e,t){var a=e.toString(),r=a.indexOf(".");if(r<0)return a;var i=Math.min(t,a.length-(r+1));return a.substring(0,r+1+i)},e}();t.Visor=s}},t={};!function a(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r].call(n.exports,n,n.exports,a),n.exports}(633)}();
//# sourceMappingURL=main.min.js.map
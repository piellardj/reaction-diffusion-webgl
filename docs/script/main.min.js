!function(){"use strict";var e={852:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;var o=r(753),u=n(r(748)),s=r(62),l=n(r(350)),d=n(r(268)),c=r(61),h=r(645),f=r(489),g=function(){function e(){var t=this;this.squareVBO=s.VBO.createQuad(o.gl,-1,-1,1,1),this.greyscaleTexture=new h.ImageTexture,this.greyscaleTexture.loadFromUrl("./resources/greyscale.png"),this.colorscaleTexture=new h.ImageTexture,this.colorscaleTexture.loadFromUrl("./resources/colorscale.png"),this.internalTextures=[new f.RenderToTextureSwapable,new f.RenderToTextureSwapable,new f.RenderToTextureSwapable],this.initialized=!1,this.lastIterationUpdate=performance.now()-5e3,this.iteration=0,this.asyncLoadShader("display-monochrome","fullscreen.vert","display/display-monochrome.frag",(function(e){t.displayMonochromeShader=e})),this.asyncLoadShader("display-tricolor","fullscreen.vert","display/display-tricolor.frag",(function(e){t.displayTricolorShader=e})),this.asyncLoadShader("display-tricolor","fullscreen.vert","display/display-ramp.frag",(function(e){t.displayRampShader=e})),this.asyncLoadShader("update-uniform","fullscreen.vert","update/update-uniform.frag",(function(e){t.updateUniformShader=e})),this.asyncLoadShader("update-map","fullscreen.vert","update/update-map.frag",(function(e){t.updateMapShader=e}),{A_FEEDING_MIN:e.A_FEEDING_MIN.toFixed(5),A_FEEDING_MAX:e.A_FEEDING_MAX.toFixed(5),B_KILLING_MIN:e.B_KILLING_MIN.toFixed(5),B_KILLING_MAX:e.B_KILLING_MAX.toFixed(5)}),this.asyncLoadShader("update-image","fullscreen.vert","update/update-map-image.frag",(function(e){t.updateImageMapShader=e})),this.asyncLoadShader("reset","fullscreen.vert","update/reset.frag",(function(e){t.resetShader=e})),this.asyncLoadShader("brush-apply","update/brush.vert","update/brush-apply.frag",(function(e){t.brushApplyShader=e})),this.asyncLoadShader("brush-display","update/brush.vert","update/brush-display.frag",(function(e){t.brushDisplayShader=e}))}return e.prototype.initialize=function(e,t){for(var r=0,a=this.internalTextures;r<a.length;r++)a[r].reserveSpace(e,t);this.initialized=!1,this.iteration=0},e.prototype.update=function(){if(this.initialized||(this.initialized=this.reset()),this.handleBrush(),this.initialized){var e=c.Parameters.speed,t=c.Parameters.parametersMap;if(t===c.EParametersMap.IMAGE){if(this.updateImageMapShader){var r=l.getTexture();this.updateImageMapShader.u.uImageMapTexture.value=r.id;var a=Page.Canvas.getAspectRatio(),i=r.width/r.height;if(this.updateImageMapShader.u.uImageMapScaling.value=a>i?[a/i,1]:[1,i/a],this.updateImageMapShader.u.uDiffuseScaling.value=c.Parameters.patternsScale,this.updateImageMapShader.use(),this.updateImageMapShader.bindAttributes(),this.updateImageMapShader.u.uTexelSize.value=[1/this.internalTextures[0].width,1/this.internalTextures[0].height],c.Parameters.displayMode===c.EDisplayMode.MONOCHROME)this.updateImageMapShader.u.uSampledChannel.value=[0,0,0,1],this.updateInternal(this.updateImageMapShader,e,this.internalTextures[0]);else{var n=Math.ceil(e/3);this.updateImageMapShader.u.uSampledChannel.value=[1,0,0,0],this.updateInternal(this.updateImageMapShader,n,this.internalTextures[0]),this.updateImageMapShader.u.uSampledChannel.value=[0,1,0,0],this.updateInternal(this.updateImageMapShader,n,this.internalTextures[1]),this.updateImageMapShader.u.uSampledChannel.value=[0,0,1,0],this.updateInternal(this.updateImageMapShader,n,this.internalTextures[2])}}}else{var o=void 0;t===c.EParametersMap.UNIFORM?this.updateUniformShader&&(this.updateUniformShader.u.uRates.value=[c.Parameters.AFeedingRate,c.Parameters.BKillingRate,c.Parameters.ADiffusionRate,c.Parameters.BDIffusionRate],o=this.updateUniformShader):t===c.EParametersMap.VALUE_PICKING&&this.updateMapShader&&(this.updateMapShader.u.uRates.value=[c.Parameters.ADiffusionRate,c.Parameters.BDIffusionRate],o=this.updateMapShader),o&&(o.use(),o.bindAttributes(),o.u.uTexelSize.value=[1/this.internalTextures[0].width,1/this.internalTextures[0].height],this.updateInternal(o,e,this.internalTextures[0]))}}},e.prototype.reset=function(){if(this.resetShader){var e=c.Parameters.initialState;this.resetShader.u.uPattern.value=[e===c.EInitialState.BLANK,e===c.EInitialState.DISC,e===c.EInitialState.CIRCLE,0],this.resetShader.use(),this.resetShader.bindUniformsAndAttributes();for(var t=0,r=this.internalTextures;t<r.length;t++){var a=r[t];o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,a.currentFramebuffer),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4)}return!0}return!1},e.prototype.drawToCanvas=function(){var e,t=c.Parameters.displayMode;if(t===c.EDisplayMode.MONOCHROME){var r=c.Parameters.shading;r===c.EShading.BINARY?this.displayMonochromeShader&&(this.displayMonochromeShader.u.uTexture.value=this.internalTextures[0].current,e=this.displayMonochromeShader):this.displayRampShader&&(this.displayRampShader.u.uTexture.value=this.internalTextures[0].current,r===c.EShading.GREYSCALE?this.displayRampShader.u.uRamp.value=this.greyscaleTexture.id:this.displayRampShader.u.uRamp.value=this.colorscaleTexture.id,e=this.displayRampShader)}else t===c.EDisplayMode.TRICOLOR&&this.displayTricolorShader&&(this.displayTricolorShader.u.uTextureRed.value=this.internalTextures[0].current,this.displayTricolorShader.u.uTextureGreen.value=this.internalTextures[1].current,this.displayTricolorShader.u.uTextureBlue.value=this.internalTextures[2].current,e=this.displayTricolorShader);e&&(o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,null),e.use(),e.bindUniformsAndAttributes(),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4))},e.prototype.displayBrush=function(){this.brushDisplayShader&&(o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,null),this.brushDisplayShader.use(),this.brushDisplayShader.bindUniformsAndAttributes(),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4))},e.prototype.updateInternal=function(e,t,r){for(var a=t;a>0;a--)r.swap(),o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,r.currentFramebuffer),e.u.uPreviousIteration.value=r.previous,e.bindUniforms(),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4);this.iteration=this._iteration+t},Object.defineProperty(e.prototype,"iteration",{set:function(e){this._iteration=e;var t=performance.now();t-this.lastIterationUpdate>200&&(Page.Canvas.setIndicatorText("iteration-indicator",this._iteration.toString()),this.lastIterationUpdate=t)},enumerable:!1,configurable:!0}),e.prototype.handleBrush=function(){if(c.Parameters.parametersMap!==c.EParametersMap.VALUE_PICKING){var e=Page.Canvas.getMousePosition();if(e[0]>=0&&e[0]<=1&&e[1]>=0&&e[1]<=1){var t=c.Parameters.brushSize,r=[e[0],1-e[1]],a=[t/this.internalTextures[0].width,t/this.internalTextures[1].height];if(this.brushApplyShader&&(this.brushApplyShader.u.uPosition.value=r,this.brushApplyShader.u.uSize.value=a),this.brushDisplayShader&&(this.brushDisplayShader.u.uPosition.value=r,this.brushDisplayShader.u.uSize.value=a),this.brushApplyShader&&Page.Canvas.isMouseDown()){this.brushApplyShader.use(),this.brushApplyShader.bindUniformsAndAttributes();for(var i=0,n=this.internalTextures;i<n.length;i++){var u=n[i];o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,u.currentFramebuffer),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4)}}}}},e.prototype.asyncLoadShader=function(e,t,r,a,i){var n=this;void 0===i&&(i={});var o="shader-"+e;d.registerLoadingObject(o),u.buildShader({fragmentFilename:r,vertexFilename:t,injected:i},(function(t){d.registerLoadedObject(o),null!==t?(t.a.aCorner.VBO=n.squareVBO,a(t)):Page.Demopage.setErrorMessage(e+"-shader-error","Failed to build '"+e+"' shader.")}))},e.A_FEEDING_MIN=.01,e.A_FEEDING_MAX=.1,e.B_KILLING_MIN=.045,e.B_KILLING_MAX=.07,e}();t.Engine=g},667:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerFrame=void 0,r(457);var a=0,i=performance.now();setInterval((function(){var e=performance.now(),t=1e3*a/(e-i);i=e,a=0,Page.Canvas.setIndicatorText("fps-indicator",Math.round(t).toString())}),500),t.registerFrame=function(){a++}},753:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.gl=t.initGL=t.adjustSize=void 0,r(457);var a=null;t.gl=a,t.initGL=function(e){function r(e){Page.Demopage.setErrorMessage("webgl-support",e)}var i=Page.Canvas.getCanvas();if(t.gl=a=i.getContext("webgl",e),null==a){if(t.gl=a=i.getContext("experimental-webgl",e),null==a)return r("Your browser or device does not seem to support WebGL."),!1;r("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.BLEND),a.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,r=a.canvas,i=Math.floor(r.clientWidth*t),n=Math.floor(r.clientHeight*t);r.width===i&&r.height===n||(r.width=i,r.height=n)}},771:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GLResource=void 0;var r=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.GLResource=r},748:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteShader=t.registerShader=t.getShader=t.buildShader=void 0;var o=r(753),u=r(490),s=n(r(71)),l={};function d(e,t){var r=2,a=0;function i(i){function n(t){return t.replace(/#INJECT\(([^)]*)\)/gm,(function(t,r){return e.injected[r]?e.injected[r]:t}))}if(r--,i||a++,0===r){var l=null;if(0===a){var d=s.getSource(e.vertexFilename),c=s.getSource(e.fragmentFilename),h=n(d),f=n(c);l=new u.Shader(o.gl,h,f)}t(l)}}s.loadSource(e.vertexFilename,i),s.loadSource(e.fragmentFilename,i)}t.getShader=function(e){return l[e].shader},t.buildShader=d,t.registerShader=function(e,t,r){function a(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===l[e]){l[e]={callbacks:[r],failed:!1,infos:t,pending:!0,shader:null};var i=l[e];d(t,(function(e){i.pending=!1,i.failed=null===e,i.shader=e,a(i)}))}else{var n=l[e];!0===n.pending?n.callbacks.push(r):a(n)}},t.deleteShader=function(e){void 0!==l[e]&&(null!==l[e].shader&&l[e].shader.freeGLResources(),delete l[e])}},71:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loadSource=t.getSource=void 0;var r={};t.loadSource=function(e,t){function a(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed);e.callbacks=[]}if(void 0===r[e]){r[e]={callbacks:[t],failed:!1,pending:!0,text:null};var i=r[e],n="./shaders/"+e;void 0!==Page.version&&(n+="?v="+Page.version);var o=new XMLHttpRequest;o.open("GET",n,!0),o.onload=function(){4===o.readyState&&(i.pending=!1,200===o.status?(i.text=o.responseText,i.failed=!1):(console.error("Cannot load '"+e+"' shader source: "+o.statusText),i.failed=!0),a(i))},o.onerror=function(){console.error("Cannot load '"+e+"' shader source: "+o.statusText),i.pending=!1,i.failed=!0,a(i)},o.send(null)}else{var u=r[e];!0===u.pending?u.callbacks.push(t):(u.callbacks=[t],a(u))}},t.getSource=function(e){return r[e].text}},490:function(e,t,r){var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;var n=r(771);function o(){alert("NOT IMPLEMENTED YET")}var u={35664:{str:"FLOAT_VEC2",binder:function(e,t,r){e.uniform2fv(t,r)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,r){e.uniform3fv(t,r)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,r){e.uniform4fv(t,r)}},35667:{str:"INT_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35668:{str:"INT_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35669:{str:"INT_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35670:{str:"BOOL",binder:function(e,t,r){e.uniform1i(t,+r)}},35671:{str:"BOOL_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35672:{str:"BOOL_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35673:{str:"BOOL_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,r){e.uniformMatrix2fv(t,!1,r)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,r){e.uniformMatrix3fv(t,!1,r)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,r){e.uniformMatrix4fv(t,!1,r)}},35678:{str:"SAMPLER_2D",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_2D,a)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_CUBE_MAP,a)}},5120:{str:"BYTE",binder:o},5121:{str:"UNSIGNED_BYTE",binder:o},5122:{str:"SHORT",binder:o},5123:{str:"UNSIGNED_SHORT",binder:o},5124:{str:"INT",binder:function(e,t,r){Array.isArray(r),e.uniform1iv(t,r)}},5125:{str:"UNSIGNED_INT",binder:o},5126:{str:"FLOAT",binder:function(e,t,r){Array.isArray(r)?e.uniform1fv(t,r):e.uniform1f(t,r)}}},s=function(e){function t(t,r,a){var i=this;function n(e,r){var a=t.createShader(e);return t.shaderSource(a,r),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(console.error(t.getShaderInfoLog(a)),console.log(r),t.deleteShader(a),null)}(i=e.call(this,t)||this).id=null,i.uCount=0,i.aCount=0;var o=n(t.VERTEX_SHADER,r),u=n(t.FRAGMENT_SHADER,a),s=t.createProgram();return t.attachShader(s,o),t.attachShader(s,u),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)?(i.id=s,i.introspection()):(console.error(t.getProgramInfoLog(s)),t.deleteProgram(s)),i}return i(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,r=e.prototype.gl.call(this),a=0;Object.keys(this.u).forEach((function(e){var i=t.u[e];if(null!==i.value)if(35678===i.type||35680===i.type){var n=a;u[i.type].binder(r,i.loc,n,i.value),a++}else u[i.type].binder(r,i.loc,i.value)}))},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach((function(t){var r=e.a[t];null!==r.VBO&&r.VBO.bind(r.loc)}))},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u={};for(var r=0;r<this.uCount;r++){var a=t.getActiveUniform(this.id,r),i=a.name;this.u[i]={loc:t.getUniformLocation(this.id,i),size:a.size,type:a.type,value:null}}for(this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a={},r=0;r<this.aCount;r++){var n=t.getActiveAttrib(this.id,r),o=n.name;this.a[o]={VBO:null,loc:t.getAttribLocation(this.id,o),size:n.size,type:n.type}}},t}(n.GLResource);t.Shader=s},62:function(e,t,r){var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.VBO=void 0;var n,o=r(771);!function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.STATIC=1]="STATIC"}(n||(n={}));var u=function(e){function t(t,r,a,i,o){void 0===o&&(o=!0);var u=e.call(this,t)||this;return u.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,u.id),o?t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW):t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),u.size=a,u.type=i,u.normalize=!1,u.stride=0,u.offset=0,u.usage=o?n.STATIC:n.DYNAMIC,u}return i(t,e),t.createQuad=function(e,r,a,i,n){return new t(e,new Float32Array([r,a,i,a,r,n,i,n]),2,e.FLOAT,!0)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var r=e.prototype.gl.call(this);r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,this.id),r.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t.prototype.setData=function(t){var r=e.prototype.gl.call(this);r.bindBuffer(r.ARRAY_BUFFER,this.id),this.usage===n.STATIC?r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW):r.bufferData(r.ARRAY_BUFFER,t,r.DYNAMIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null)},t}(o.GLResource);t.VBO=u},350:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getTexture=void 0;var a,i=r(61),n=r(645),o=document.createElement("canvas"),u=o.getContext("2d"),s=null;function l(e,t,r){return.21*e+.72*t+.07*r}i.Parameters.imageUploadObservers.push((function(e){a=function(e){var t=Math.min(1,512/Math.max(e.width,e.height)),r=Math.ceil(t*e.width),a=Math.ceil(t*e.height);o.width=r,o.height=a,u.drawImage(e,0,0,r,a);for(var i=u.getImageData(0,0,o.width,o.height),n=new Uint8ClampedArray(i.data),s=0,d=i.height-1;d>=0;d--)for(var c=0;c<i.width;c++){var h=n[4*(c+d*i.width)],f=n[4*(c+d*i.width)+1],g=n[4*(c+d*i.width)+2],p=l(h,f,g);i.data[s++]=h,i.data[s++]=f,i.data[s++]=g,i.data[s++]=p}return i}(e),null!==s&&s.uploadDataToGPU(a)})),t.getTexture=function(){return null===s&&(s=new n.ImageTexture(a)),s}},268:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerLoadingObject=t.registerLoadedObject=void 0,r(457);var a={};t.registerLoadingObject=function(e){0===Object.keys(a).length&&Page.Canvas.showLoader(!0),a[e]=!1},t.registerLoadedObject=function(e){delete a[e],0===Object.keys(a).length&&Page.Canvas.showLoader(!1)}},633:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var o=r(852),u=n(r(667)),s=n(r(753)),l=r(753),d=r(61),c=r(336);function h(e){var t=d.Parameters.blur;e.style.filter=t<=0?"":"blur("+t+"px)"}r(457),function(){if(s.initGL({alpha:!1,antialias:!0,depth:!1,stencil:!1,preserveDrawingBuffer:!1})){l.gl.disable(l.gl.CULL_FACE),l.gl.disable(l.gl.BLEND);var e=Page.Canvas.getCanvas();d.Parameters.blurChangeObservers.push((function(){h(e)})),h(e);var t=!0;d.Parameters.canvasResizeObservers.push((function(){t=!0}));var r=!0;d.Parameters.resetObservers.push((function(){r=!0}));var a=!1;d.Parameters.imageDownloadObservers.push((function(){a=!0}));var i=new o.Engine,n=new c.Visor;!function o(){u.registerFrame(),a&&(i.drawToCanvas(),function(e){var t="reaction-diffusion.png";if(e.msToBlob){var r=e.msToBlob();window.navigator.msSaveBlob(r,t)}else e.toBlob((function(e){var r=document.createElement("a");r.download=t,r.href=URL.createObjectURL(e),r.click()}))}(e),a=!1),t&&(s.adjustSize(!1),l.gl.viewport(0,0,e.width,e.height),i.initialize(e.width,e.height),t=!1),r&&(i.initialize(e.width,e.height),r=!1),i.update(),i.drawToCanvas(),n.update(),d.Parameters.displayBrush&&i.displayBrush(),requestAnimationFrame(o)}()}}()},457:function(){},61:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=t.EShading=t.EParametersMap=t.EInitialState=t.EDisplayMode=void 0;var o=n(r(268));r(457);var u,s="map-tabs-id",l="input-image-upload-button",d="pattern-scale-range-id",c="A-feeding-range-id",h="A-diffusion-range-id",f="B-killing-range-id",g="B-diffusion-range-id",p="pick-values-button-id",b="reset-values-button-id",v="initial-state-tabs-id",m="display-mode-tabs-id",T="shading-tabs-id",E="blur-range-id",_="indicators-checkbox-id";function y(e){for(var t=0,r=e;t<r.length;t++)(0,r[t])()}!function(e){e.UNIFORM="uniform",e.VALUE_PICKING="value_picking",e.IMAGE="image"}(u||(u={})),t.EParametersMap=u;var P,R,A,O=!1;!function(e){e.BLANK="blank",e.DISC="disc",e.CIRCLE="circle"}(P||(P={})),t.EInitialState=P,function(e){e.MONOCHROME="monochrome",e.TRICOLOR="tricolor"}(R||(R={})),t.EDisplayMode=R,function(e){e.BINARY="binary",e.GREYSCALE="greyscale",e.COLORSCALE="colorscale"}(A||(A={})),t.EShading=A;var S=function(){var e=I.parametersMap,t=I.displayMode;Page.Controls.setVisibility(c,e!==u.IMAGE),Page.Controls.setVisibility(f,e!==u.IMAGE),Page.Controls.setVisibility(p,e!==u.IMAGE),Page.Controls.setVisibility(b,e!==u.IMAGE),Page.Controls.setVisibility(d,e===u.IMAGE),Page.Controls.setVisibility(h,e!==u.IMAGE),Page.Controls.setVisibility(g,e!==u.IMAGE),Page.Controls.setVisibility(l,e===u.IMAGE),Page.Controls.setVisibility(m,e===u.IMAGE),Page.Controls.setVisibility(T,t===R.MONOCHROME)},I=function(){function e(){}return Object.defineProperty(e,"parametersMap",{get:function(){return O?u.VALUE_PICKING:Page.Tabs.getValues(s)[0]},enumerable:!1,configurable:!0}),e.exitValuePickingMode=function(){O=!1,Page.Tabs.setValues(s,[u.UNIFORM]),S()},Object.defineProperty(e,"patternsScale",{get:function(){return Page.Range.getValue(d)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"AFeedingRate",{get:function(){return Page.Range.getValue(c)},set:function(e){Page.Range.setValue(c,e,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ADiffusionRate",{get:function(){return Page.Range.getValue(h)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BKillingRate",{get:function(){return Page.Range.getValue(f)},set:function(e){Page.Range.setValue(f,e,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BDIffusionRate",{get:function(){return Page.Range.getValue(g)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"speed",{get:function(){return Page.Range.getValue("speed-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"brushSize",{get:function(){return Page.Range.getValue("brush-size-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayBrush",{get:function(){return!O&&Page.Checkbox.isChecked("brush-display-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"initialState",{get:function(){return O?P.CIRCLE:Page.Tabs.getValues(v)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"blur",{get:function(){return Page.Range.getValue(E)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayMode",{get:function(){return e.parametersMap===u.IMAGE?Page.Tabs.getValues(m)[0]:R.MONOCHROME},enumerable:!1,configurable:!0}),Object.defineProperty(e,"shading",{get:function(){return Page.Tabs.getValues(T)[0]},enumerable:!1,configurable:!0}),e.imageUploadObservers=[],e.imageDownloadObservers=[],e.canvasResizeObservers=[],e.resetObservers=[],e.blurChangeObservers=[],e}();t.Parameters=I,Page.Canvas.Observers.canvasResize.push((function(){y(I.canvasResizeObservers)}));var M=function(){y(I.resetObservers)};Page.Button.addObserver("reset-button-id",M),Page.Tabs.addObserver(s,M),Page.Tabs.addObserver(m,M),Page.Tabs.addObserver(v,M),I.imageUploadObservers.push(M),Page.Tabs.addObserver(s,(function(){O=!1,S()})),Page.Tabs.addObserver(m,S),S();var x=function(){Page.Canvas.setIndicatorsVisibility(Page.Checkbox.isChecked(_))};Page.Checkbox.addObserver(_,x),x(),Page.Button.addObserver(b,(function(){Page.Range.setValue(c,.054,!0),Page.Range.setValue(h,.2097,!0),Page.Range.setValue(f,.062,!0),Page.Range.setValue(g,.105,!0)})),Page.Button.addObserver(p,(function(){Page.Tabs.setValues(s,[]),O=!0,S(),M()})),Page.Range.addObserver(E,(function(){y(I.blurChangeObservers)})),Page.FileControl.addUploadObserver(l,(function(e){if(1===e.length){var t=new FileReader;t.onload=function(){var e=new Image;e.addEventListener("load",(function(){for(var t=0,r=I.imageUploadObservers;t<r.length;t++)(0,r[t])(e)})),e.src=t.result},t.readAsDataURL(e[0])}}));var C="./resources/cat.jpg?v="+Page.version;o.registerLoadingObject(C);var L=new Image;L.addEventListener("load",(function(){o.registerLoadedObject(C);for(var e=0,t=I.imageUploadObservers;e<t.length;e++)(0,t[e])(L)})),L.src=C,Page.FileControl.addDownloadObserver("image-download-id",(function(){y(I.imageDownloadObservers),M()}))},645:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageTexture=void 0;var o=r(753),u=n(r(268)),s={data:new Uint8ClampedArray([128,128,128,128]),width:1,height:1},l=function(){function e(e){this._width=-1,this._height=-1,this.id=o.gl.createTexture(),this.uploadDataToGPU(null!=e?e:s)}return e.prototype.loadFromUrl=function(e){var t=this;e=e+"?v="+Page.version,u.registerLoadingObject(e);var r=new Image;r.addEventListener("load",(function(){u.registerLoadedObject(e),t.uploadImageToGPU(r)})),r.src=e},e.prototype.uploadDataToGPU=function(e){this._width=e.width,this._height=e.height,o.gl.bindTexture(o.gl.TEXTURE_2D,this.id),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_WRAP_S,o.gl.CLAMP_TO_EDGE),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_WRAP_T,o.gl.CLAMP_TO_EDGE),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_MIN_FILTER,o.gl.LINEAR),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_MAG_FILTER,o.gl.LINEAR),o.gl.texImage2D(o.gl.TEXTURE_2D,0,o.gl.RGBA,e.width,e.height,0,o.gl.RGBA,o.gl.UNSIGNED_BYTE,e.data),o.gl.bindTexture(o.gl.TEXTURE_2D,null)},e.prototype.uploadImageToGPU=function(e){this._width=e.width,this._height=e.height,o.gl.bindTexture(o.gl.TEXTURE_2D,this.id),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_WRAP_S,o.gl.CLAMP_TO_EDGE),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_WRAP_T,o.gl.CLAMP_TO_EDGE),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_MIN_FILTER,o.gl.LINEAR),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_MAG_FILTER,o.gl.LINEAR),o.gl.texImage2D(o.gl.TEXTURE_2D,0,o.gl.RGBA,o.gl.RGBA,o.gl.UNSIGNED_BYTE,e),o.gl.bindTexture(o.gl.TEXTURE_2D,null)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}();t.ImageTexture=l},489:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RenderToTextureSwapable=void 0;var a=r(991),i=function(){function e(){this.previousTexture=new a.RenderToTexture,this.currentTexture=new a.RenderToTexture}return Object.defineProperty(e.prototype,"previous",{get:function(){return this.previousTexture.texture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.currentTexture.texture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFramebuffer",{get:function(){return this.currentTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.previousTexture.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.previousTexture.height},enumerable:!1,configurable:!0}),e.prototype.reserveSpace=function(e,t){this.previousTexture.reserveSpace(e,t),this.currentTexture.reserveSpace(e,t)},e.prototype.swap=function(){var e=this.currentTexture;this.currentTexture=this.previousTexture,this.previousTexture=e},e}();t.RenderToTextureSwapable=i},991:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RenderToTexture=void 0;var a=r(753),i=function(){function e(){this.texture=a.gl.createTexture(),this.framebuffer=a.gl.createFramebuffer(),this._width=-1,this._height=-1}return e.prototype.reserveSpace=function(e,t){if(e=Math.ceil(e),t=Math.ceil(t),this.width!==e||this.height!==t){a.gl.bindTexture(a.gl.TEXTURE_2D,this.texture);var r=a.gl.RGBA;a.gl.texImage2D(a.gl.TEXTURE_2D,0,r,e,t,0,r,a.gl.UNSIGNED_BYTE,null),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MIN_FILTER,a.gl.LINEAR),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_S,a.gl.CLAMP_TO_EDGE),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_T,a.gl.CLAMP_TO_EDGE),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,this.framebuffer),a.gl.framebufferTexture2D(a.gl.FRAMEBUFFER,a.gl.COLOR_ATTACHMENT0,a.gl.TEXTURE_2D,this.texture,0),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,null),a.gl.bindTexture(a.gl.TEXTURE_2D,null),this._width=e,this._height=t}},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}();t.RenderToTexture=i},336:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Visor=void 0;var a,i=r(852),n=r(61);r(457),function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(a||(a={}));var o=function(){function e(){var t=Page.Canvas.getCanvasContainer();this.horizontalLine=e.createBar(a.HORIZONTAL,"B killing rate"),t.appendChild(this.horizontalLine.container),this.verticalLine=e.createBar(a.VERTICAL,"A feeding rate"),t.appendChild(this.verticalLine.container),Page.Canvas.getCanvas().addEventListener("click",(function(){if(n.Parameters.parametersMap===n.EParametersMap.VALUE_PICKING){var t=Page.Canvas.getMousePosition();n.Parameters.AFeedingRate=e.aimedFeedA(t),n.Parameters.BKillingRate=e.aimedKillB(t),n.Parameters.exitValuePickingMode()}}))}return e.prototype.update=function(){var t=Page.Canvas.getMousePosition(),r=n.Parameters.parametersMap===n.EParametersMap.VALUE_PICKING&&e.isInRange(0,1,t[0])&&e.isInRange(0,1,t[1]);if(r){this.horizontalLine.legendValue.textContent=e.toString(e.aimedFeedA(t),5),this.verticalLine.legendValue.textContent=e.toString(e.aimedKillB(t),5);var a,i=Page.Canvas.getSize(),o=Math.round(t[0]*i[0]),u=Math.round(t[1]*i[1]);this.horizontalLine.container.style.left=o+"px",o-.5*(a=this.horizontalLine.legendContainer.getBoundingClientRect().width)<0?this.horizontalLine.legendContainer.style.left=.5*a-o+"px":o+.5*a>i[0]?this.horizontalLine.legendContainer.style.left=i[0]-(o+.5*a)+"px":this.horizontalLine.legendContainer.style.left="",this.verticalLine.container.style.top=u+"px",u-.5*(a=this.verticalLine.legendContainer.getBoundingClientRect().height)<0?this.verticalLine.legendContainer.style.top=.5*a-u+"px":u+.5*a>i[1]?this.verticalLine.legendContainer.style.top=i[1]-(u+.5*a)+"px":this.verticalLine.legendContainer.style.top=""}var s=r?"":"none";this.horizontalLine.container.style.display=s,this.verticalLine.container.style.display=s},e.aimedFeedA=function(t){var r=e.clamp(0,1,1-t[1]);return e.interpolate(i.Engine.A_FEEDING_MIN,i.Engine.A_FEEDING_MAX,r)},e.aimedKillB=function(t){var r=e.clamp(0,1,t[0]);return e.interpolate(i.Engine.B_KILLING_MIN,i.Engine.B_KILLING_MAX,r)},e.createBar=function(e,t){var r=document.createElement("div");r.classList.add("visor-bar"),r.classList.add(e),r.style.display="none";var a=document.createElement("div");a.classList.add("visor-bar-legend");var i=document.createElement("span");i.textContent=t,a.appendChild(i),a.appendChild(document.createElement("br"));var n=document.createElement("span");return n.textContent="?",a.appendChild(n),r.appendChild(a),{container:r,legendContainer:a,legendValue:n}},e.clamp=function(e,t,r){return r<e?e:r>t?t:r},e.interpolate=function(e,t,r){return t*r+e*(1-r)},e.isInRange=function(e,t,r){return e<=r&&r<=t},e.toString=function(e,t){var r=e.toString(),a=r.indexOf(".");if(a<0)return r;var i=Math.min(t,r.length-(a+1));return r.substring(0,a+1+i)},e}();t.Visor=o}},t={};!function r(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,r),n.exports}(633)}();
//# sourceMappingURL=main.min.js.map
!function(){"use strict";var e={852:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;var o=r(689),s=r(753),u=n(r(748)),l=r(62),d=n(r(350)),c=n(r(268)),f=r(61),g=r(645),h=r(489),p=function(){function e(){var t=this;this.lastUpdateTimestamp=0,this.squareVBO=l.VBO.createQuad(s.gl,-1,-1,1,1),this.greyscaleTexture=new g.ImageTexture,this.greyscaleTexture.loadFromUrl("./resources/greyscale.png"),this.colorscaleTexture=new g.ImageTexture,this.colorscaleTexture.loadFromUrl("./resources/colorscale.png"),this.internalTextures=[new h.RenderToTextureSwapable,new h.RenderToTextureSwapable,new h.RenderToTextureSwapable],this.initialized=!1,this.lastIterationUpdate=performance.now()-5e3,this.iteration=0,this.asyncLoadShader("display-monochrome","fullscreen.vert","display/display-monochrome.frag",(function(e){t.displayMonochromeShader=e})),this.asyncLoadShader("display-tricolor","fullscreen.vert","display/display-tricolor.frag",(function(e){t.displayTricolorShader=e})),this.asyncLoadShader("display-tricolor","fullscreen.vert","display/display-ramp.frag",(function(e){t.displayRampShader=e})),this.asyncLoadShader("update-uniform","fullscreen.vert","update/update-uniform.frag",(function(e){t.updateUniformShader=e})),this.asyncLoadShader("update-map","fullscreen.vert","update/update-map.frag",(function(e){t.updateMapShader=e}),{A_FEEDING_MIN:e.A_FEEDING_MIN.toFixed(5),A_FEEDING_MAX:e.A_FEEDING_MAX.toFixed(5),B_KILLING_MIN:e.B_KILLING_MIN.toFixed(5),B_KILLING_MAX:e.B_KILLING_MAX.toFixed(5)}),this.asyncLoadShader("update-image","fullscreen.vert","update/update-map-image.frag",(function(e){t.updateImageMapShader=e})),this.asyncLoadShader("reset","fullscreen.vert","update/reset.frag",(function(e){t.resetShader=e})),this.asyncLoadShader("brush-apply","update/brush.vert","update/brush-apply.frag",(function(e){t.brushApplyShader=e})),this.asyncLoadShader("brush-display","update/brush.vert","update/brush-display.frag",(function(e){t.brushDisplayShader=e}))}return e.prototype.initialize=function(e,t){for(var r=0,a=this.internalTextures;r<a.length;r++)a[r].reserveSpace(e,t);this.initialized=!1,this.iteration=0},e.prototype.update=function(){if(this.initialized||(this.initialized=this.reset()),this.handleBrush(),this.initialized){var e=this.computeNbIterationsForThisFrame();if(e<=0)return;var t=f.Parameters.parametersMap;if(t===o.EParametersMap.IMAGE){if(this.updateImageMapShader){var r=d.getTexture();this.updateImageMapShader.u.uImageMapTexture.value=r.id;var a=Page.Canvas.getAspectRatio(),i=r.width/r.height;if(this.updateImageMapShader.u.uImageMapScaling.value=a>i?[a/i,1]:[1,i/a],this.updateImageMapShader.u.uDiffuseScaling.value=f.Parameters.patternsScale,this.updateImageMapShader.use(),this.updateImageMapShader.bindAttributes(),this.updateImageMapShader.u.uTexelSize.value=[1/this.internalTextures[0].width,1/this.internalTextures[0].height],f.Parameters.displayMode===o.EDisplayMode.MONOCHROME)this.updateImageMapShader.u.uSampledChannel.value=[0,0,0,1],this.updateInternal(this.updateImageMapShader,e,this.internalTextures[0]);else{var n=Math.ceil(e/3);this.updateImageMapShader.u.uSampledChannel.value=[1,0,0,0],this.updateInternal(this.updateImageMapShader,n,this.internalTextures[0]),this.updateImageMapShader.u.uSampledChannel.value=[0,1,0,0],this.updateInternal(this.updateImageMapShader,n,this.internalTextures[1]),this.updateImageMapShader.u.uSampledChannel.value=[0,0,1,0],this.updateInternal(this.updateImageMapShader,n,this.internalTextures[2])}}}else{var s=void 0;t===o.EParametersMap.UNIFORM?this.updateUniformShader&&(this.updateUniformShader.u.uRates.value=[f.Parameters.AFeedingRate,f.Parameters.BKillingRate,f.Parameters.ADiffusionRate,f.Parameters.BDIffusionRate],s=this.updateUniformShader):t===o.EParametersMap.VALUE_PICKING&&this.updateMapShader&&(this.updateMapShader.u.uRates.value=[f.Parameters.ADiffusionRate,f.Parameters.BDIffusionRate],s=this.updateMapShader),s&&(s.use(),s.bindAttributes(),s.u.uTexelSize.value=[1/this.internalTextures[0].width,1/this.internalTextures[0].height],this.updateInternal(s,e,this.internalTextures[0]))}}},e.prototype.reset=function(){if(this.resetShader){var e=f.Parameters.initialState;this.resetShader.u.uPattern.value=[e===o.EInitialState.BLANK,e===o.EInitialState.DISC,e===o.EInitialState.CIRCLE,0],this.resetShader.use(),this.resetShader.bindUniformsAndAttributes();for(var t=0,r=this.internalTextures;t<r.length;t++){var a=r[t];s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,a.currentFramebuffer),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4)}return!0}return!1},e.prototype.drawToCanvas=function(){var e,t=f.Parameters.displayMode;if(t===o.EDisplayMode.MONOCHROME){var r=f.Parameters.shading;r===o.EShading.BINARY?this.displayMonochromeShader&&(this.displayMonochromeShader.u.uTexture.value=this.internalTextures[0].current,e=this.displayMonochromeShader):this.displayRampShader&&(this.displayRampShader.u.uTexture.value=this.internalTextures[0].current,r===o.EShading.GREYSCALE?this.displayRampShader.u.uRamp.value=this.greyscaleTexture.id:this.displayRampShader.u.uRamp.value=this.colorscaleTexture.id,e=this.displayRampShader)}else t===o.EDisplayMode.TRICOLOR&&this.displayTricolorShader&&(this.displayTricolorShader.u.uTextureRed.value=this.internalTextures[0].current,this.displayTricolorShader.u.uTextureGreen.value=this.internalTextures[1].current,this.displayTricolorShader.u.uTextureBlue.value=this.internalTextures[2].current,e=this.displayTricolorShader);e&&(e.u.uScaling.value=1/f.Parameters.zoom,s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,null),e.use(),e.bindUniformsAndAttributes(),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4))},e.prototype.displayBrush=function(){this.brushDisplayShader&&(s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,null),this.brushDisplayShader.use(),this.brushDisplayShader.bindUniformsAndAttributes(),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4))},e.prototype.updateInternal=function(e,t,r){for(var a=t;a>0;a--)r.swap(),s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,r.currentFramebuffer),e.u.uPreviousIteration.value=r.previous,e.bindUniforms(),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4);this.iteration=this._iteration+t},Object.defineProperty(e.prototype,"iteration",{set:function(e){this._iteration=e;var t=performance.now();t-this.lastIterationUpdate>200&&(Page.Canvas.setIndicatorText("iteration-indicator",this._iteration.toString()),this.lastIterationUpdate=t)},enumerable:!1,configurable:!0}),e.prototype.handleBrush=function(){if(f.Parameters.parametersMap!==o.EParametersMap.VALUE_PICKING){var e=Page.Canvas.getMousePosition();if(e[0]>=0&&e[0]<=1&&e[1]>=0&&e[1]<=1){var t=f.Parameters.brushSize,r=[e[0],1-e[1]],a=[t/this.internalTextures[0].width,t/this.internalTextures[1].height];if(this.brushApplyShader){var i=f.Parameters.zoom;this.brushApplyShader.u.uPosition.value=[.5+(r[0]-.5)/i,.5+(r[1]-.5)/i],this.brushApplyShader.u.uSize.value=[a[0]/i,a[1]/i]}if(this.brushDisplayShader&&(this.brushDisplayShader.u.uPosition.value=r,this.brushDisplayShader.u.uSize.value=a),this.brushApplyShader&&Page.Canvas.isMouseDown()){this.brushApplyShader.use(),this.brushApplyShader.bindUniformsAndAttributes();for(var n=0,u=this.internalTextures;n<u.length;n++){var l=u[n];s.gl.bindFramebuffer(s.gl.FRAMEBUFFER,l.currentFramebuffer),s.gl.drawArrays(s.gl.TRIANGLE_STRIP,0,4)}}}}},e.prototype.asyncLoadShader=function(e,t,r,a,i){var n=this;void 0===i&&(i={});var o="shader-"+e;c.registerLoadingObject(o),u.buildShader({fragmentFilename:r,vertexFilename:t,injected:i},(function(t){c.registerLoadedObject(o),null!==t?(t.a.aCorner.VBO=n.squareVBO,a(t)):Page.Demopage.setErrorMessage(e+"-shader-error","Failed to build '"+e+"' shader.")}))},e.prototype.computeNbIterationsForThisFrame=function(){var e=f.Parameters.speed,t=performance.now(),r=1e3/(.1+t-this.lastUpdateTimestamp);return this.lastUpdateTimestamp=t,r>60?Math.ceil(60/r*e):r<10?Math.ceil(r/10*e):e},e.A_FEEDING_MIN=.01,e.A_FEEDING_MAX=.1,e.B_KILLING_MIN=.045,e.B_KILLING_MAX=.07,e}();t.Engine=p},689:function(e,t){var r,a,i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.EParametersMap=t.EShading=t.EInitialState=t.EDisplayMode=void 0,function(e){e.UNIFORM="uniform",e.VALUE_PICKING="value_picking",e.IMAGE="image"}(r||(r={})),t.EParametersMap=r,function(e){e.BLANK="blank",e.DISC="disc",e.CIRCLE="circle"}(a||(a={})),t.EInitialState=a,function(e){e.MONOCHROME="monochrome",e.TRICOLOR="tricolor"}(i||(i={})),t.EDisplayMode=i,function(e){e.BINARY="binary",e.GREYSCALE="greyscale",e.COLORSCALE="colorscale"}(n||(n={})),t.EShading=n},667:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerFrame=void 0,r(457);var a=0,i=performance.now();setInterval((function(){var e=performance.now(),t=1e3*a/(e-i);i=e,a=0,Page.Canvas.setIndicatorText("fps-indicator",Math.round(t).toString())}),500),t.registerFrame=function(){a++}},753:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.gl=t.initGL=t.adjustSize=void 0,r(457);var a=null;t.gl=a,t.initGL=function(e){function r(e){Page.Demopage.setErrorMessage("webgl-support",e)}var i=Page.Canvas.getCanvas();if(t.gl=a=i.getContext("webgl",e),null==a){if(t.gl=a=i.getContext("experimental-webgl",e),null==a)return r("Your browser or device does not seem to support WebGL."),!1;r("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.BLEND),a.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,r=a.canvas,i=Math.floor(r.clientWidth*t),n=Math.floor(r.clientHeight*t);r.width===i&&r.height===n||(r.width=i,r.height=n)}},771:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GLResource=void 0;var r=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.GLResource=r},748:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteShader=t.registerShader=t.getShader=t.buildShader=void 0;var o=r(753),s=r(490),u=n(r(71)),l={};function d(e,t){var r=2,a=0;function i(i){function n(t){return t.replace(/#INJECT\(([^)]*)\)/gm,(function(t,r){return e.injected[r]?e.injected[r]:t}))}if(r--,i||a++,0===r){var l=null;if(0===a){var d=u.getSource(e.vertexFilename),c=u.getSource(e.fragmentFilename),f=n(d),g=n(c);l=new s.Shader(o.gl,f,g)}t(l)}}u.loadSource(e.vertexFilename,i),u.loadSource(e.fragmentFilename,i)}t.getShader=function(e){return l[e].shader},t.buildShader=d,t.registerShader=function(e,t,r){function a(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===l[e]){l[e]={callbacks:[r],failed:!1,infos:t,pending:!0,shader:null};var i=l[e];d(t,(function(e){i.pending=!1,i.failed=null===e,i.shader=e,a(i)}))}else{var n=l[e];!0===n.pending?n.callbacks.push(r):a(n)}},t.deleteShader=function(e){void 0!==l[e]&&(null!==l[e].shader&&l[e].shader.freeGLResources(),delete l[e])}},71:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loadSource=t.getSource=void 0;var r={};t.loadSource=function(e,t){function a(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed);e.callbacks=[]}if(void 0===r[e]){r[e]={callbacks:[t],failed:!1,pending:!0,text:null};var i=r[e],n="./shaders/"+e;void 0!==Page.version&&(n+="?v="+Page.version);var o=new XMLHttpRequest;o.open("GET",n,!0),o.onload=function(){4===o.readyState&&(i.pending=!1,200===o.status?(i.text=o.responseText,i.failed=!1):(console.error("Cannot load '"+e+"' shader source: "+o.statusText),i.failed=!0),a(i))},o.onerror=function(){console.error("Cannot load '"+e+"' shader source: "+o.statusText),i.pending=!1,i.failed=!0,a(i)},o.send(null)}else{var s=r[e];!0===s.pending?s.callbacks.push(t):(s.callbacks=[t],a(s))}},t.getSource=function(e){return r[e].text}},490:function(e,t,r){var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;var n=r(771);function o(){alert("NOT IMPLEMENTED YET")}var s={35664:{str:"FLOAT_VEC2",binder:function(e,t,r){e.uniform2fv(t,r)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,r){e.uniform3fv(t,r)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,r){e.uniform4fv(t,r)}},35667:{str:"INT_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35668:{str:"INT_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35669:{str:"INT_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35670:{str:"BOOL",binder:function(e,t,r){e.uniform1i(t,+r)}},35671:{str:"BOOL_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35672:{str:"BOOL_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35673:{str:"BOOL_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,r){e.uniformMatrix2fv(t,!1,r)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,r){e.uniformMatrix3fv(t,!1,r)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,r){e.uniformMatrix4fv(t,!1,r)}},35678:{str:"SAMPLER_2D",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_2D,a)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,r,a){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_CUBE_MAP,a)}},5120:{str:"BYTE",binder:o},5121:{str:"UNSIGNED_BYTE",binder:o},5122:{str:"SHORT",binder:o},5123:{str:"UNSIGNED_SHORT",binder:o},5124:{str:"INT",binder:function(e,t,r){Array.isArray(r),e.uniform1iv(t,r)}},5125:{str:"UNSIGNED_INT",binder:o},5126:{str:"FLOAT",binder:function(e,t,r){Array.isArray(r)?e.uniform1fv(t,r):e.uniform1f(t,r)}}},u=function(e){function t(t,r,a){var i=this;function n(e,r){var a=t.createShader(e);return t.shaderSource(a,r),t.compileShader(a),t.getShaderParameter(a,t.COMPILE_STATUS)?a:(console.error(t.getShaderInfoLog(a)),console.log(r),t.deleteShader(a),null)}(i=e.call(this,t)||this).id=null,i.uCount=0,i.aCount=0;var o=n(t.VERTEX_SHADER,r),s=n(t.FRAGMENT_SHADER,a),u=t.createProgram();return t.attachShader(u,o),t.attachShader(u,s),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)?(i.id=u,i.introspection()):(console.error(t.getProgramInfoLog(u)),t.deleteProgram(u)),i}return i(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,r=e.prototype.gl.call(this),a=0;Object.keys(this.u).forEach((function(e){var i=t.u[e];if(null!==i.value)if(35678===i.type||35680===i.type){var n=a;s[i.type].binder(r,i.loc,n,i.value),a++}else s[i.type].binder(r,i.loc,i.value)}))},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach((function(t){var r=e.a[t];null!==r.VBO&&r.VBO.bind(r.loc)}))},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u={};for(var r=0;r<this.uCount;r++){var a=t.getActiveUniform(this.id,r),i=a.name;this.u[i]={loc:t.getUniformLocation(this.id,i),size:a.size,type:a.type,value:null}}for(this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a={},r=0;r<this.aCount;r++){var n=t.getActiveAttrib(this.id,r),o=n.name;this.a[o]={VBO:null,loc:t.getAttribLocation(this.id,o),size:n.size,type:n.type}}},t}(n.GLResource);t.Shader=u},62:function(e,t,r){var a,i=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.VBO=void 0;var n,o=r(771);!function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.STATIC=1]="STATIC"}(n||(n={}));var s=function(e){function t(t,r,a,i,o){void 0===o&&(o=!0);var s=e.call(this,t)||this;return s.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,s.id),o?t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW):t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),s.size=a,s.type=i,s.normalize=!1,s.stride=0,s.offset=0,s.usage=o?n.STATIC:n.DYNAMIC,s}return i(t,e),t.createQuad=function(e,r,a,i,n){return new t(e,new Float32Array([r,a,i,a,r,n,i,n]),2,e.FLOAT,!0)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var r=e.prototype.gl.call(this);r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,this.id),r.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t.prototype.setData=function(t){var r=e.prototype.gl.call(this);r.bindBuffer(r.ARRAY_BUFFER,this.id),this.usage===n.STATIC?r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW):r.bufferData(r.ARRAY_BUFFER,t,r.DYNAMIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null)},t}(o.GLResource);t.VBO=s},350:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getTexture=void 0;var a,i=r(61),n=r(645),o=document.createElement("canvas"),s=o.getContext("2d"),u=null;function l(e,t,r){return.21*e+.72*t+.07*r}i.Parameters.imageUploadObservers.push((function(e){a=function(e){var t=Math.min(1,512/Math.max(e.width,e.height)),r=Math.ceil(t*e.width),a=Math.ceil(t*e.height);o.width=r,o.height=a,s.drawImage(e,0,0,r,a);for(var i=s.getImageData(0,0,o.width,o.height),n=new Uint8ClampedArray(i.data),u=0,d=i.height-1;d>=0;d--)for(var c=0;c<i.width;c++){var f=n[4*(c+d*i.width)],g=n[4*(c+d*i.width)+1],h=n[4*(c+d*i.width)+2],p=l(f,g,h);i.data[u++]=f,i.data[u++]=g,i.data[u++]=h,i.data[u++]=p}return i}(e),null!==u&&u.uploadDataToGPU(a)})),t.getTexture=function(){return null===u&&(u=new n.ImageTexture(a)),u}},268:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerLoadingObject=t.registerLoadedObject=void 0,r(457);var a={};t.registerLoadingObject=function(e){0===Object.keys(a).length&&Page.Canvas.showLoader(!0),a[e]=!1},t.registerLoadedObject=function(e){delete a[e],0===Object.keys(a).length&&Page.Canvas.showLoader(!1)}},633:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var o=r(852),s=n(r(667)),u=n(r(753)),l=r(753),d=r(61),c=r(336);function f(e){var t=d.Parameters.blur;e.style.filter=t<=0?"":"blur("+t+"px)"}r(457),function(){if(u.initGL({alpha:!1,antialias:!0,depth:!1,stencil:!1,preserveDrawingBuffer:!1})){l.gl.disable(l.gl.CULL_FACE),l.gl.disable(l.gl.BLEND);var e=Page.Canvas.getCanvas();d.Parameters.blurChangeObservers.push((function(){f(e)})),f(e);var t=!0;d.Parameters.canvasResizeObservers.push((function(){t=!0}));var r=!0;d.Parameters.resetObservers.push((function(){r=!0}));var a=!1;d.Parameters.imageDownloadObservers.push((function(){a=!0}));var i=new o.Engine,n=new c.Visor;!function o(){s.registerFrame(),a&&(i.drawToCanvas(),function(e){var t="reaction-diffusion.png";if(e.msToBlob){var r=e.msToBlob();window.navigator.msSaveBlob(r,t)}else e.toBlob((function(e){var r=document.createElement("a");r.download=t,r.href=URL.createObjectURL(e),r.click()}))}(e),a=!1),t&&(u.adjustSize(!1),l.gl.viewport(0,0,e.width,e.height),i.initialize(e.width,e.height),t=!1),r&&(i.initialize(e.width,e.height),r=!1),i.update(),i.drawToCanvas(),n.update(),d.Parameters.displayBrush&&i.displayBrush(),requestAnimationFrame(o)}()}}()},457:function(){},61:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=void 0;var o=r(689),s=n(r(268)),u=r(470);r(457);var l="map-tabs-id",d="presets-fixed-select-id",c="input-image-upload-button",f="pattern-scale-range-id",g="A-feeding-range-id",h="A-diffusion-range-id",p="B-killing-range-id",b="B-diffusion-range-id",v="pick-values-button-id",m="reset-values-button-id",E="speed-range-id",T="initial-state-tabs-id",P="display-mode-tabs-id",_="shading-tabs-id",y="zoom-range-id",R="blur-range-id",S="indicators-checkbox-id";function O(e){for(var t=0,r=e;t<r.length;t++)(0,r[t])()}var A=!1,I=function(){var e=C.parametersMap,t=C.displayMode;Page.Controls.setVisibility(d,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(g,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(p,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(v,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(m,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(f,e===o.EParametersMap.IMAGE),Page.Controls.setVisibility(h,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(b,e!==o.EParametersMap.IMAGE),Page.Controls.setVisibility(c,e===o.EParametersMap.IMAGE),Page.Controls.setVisibility(P,e===o.EParametersMap.IMAGE),Page.Controls.setVisibility(_,t===o.EDisplayMode.MONOCHROME)};function M(){Page.Select.setValue(d,null)}Page.Range.addObserver(g,M),Page.Range.addObserver(h,M),Page.Range.addObserver(p,M),Page.Range.addObserver(b,M);var C=function(){function e(){}return Object.defineProperty(e,"parametersMap",{get:function(){return A?o.EParametersMap.VALUE_PICKING:Page.Tabs.getValues(l)[0]},enumerable:!1,configurable:!0}),e.exitValuePickingMode=function(){A=!1,Page.Tabs.setValues(l,[o.EParametersMap.UNIFORM]),I()},Object.defineProperty(e,"patternsScale",{get:function(){return Page.Range.getValue(f)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"AFeedingRate",{get:function(){return Page.Range.getValue(g)},set:function(e){Page.Range.setValue(g,e,!0),M()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ADiffusionRate",{get:function(){return Page.Range.getValue(h)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BKillingRate",{get:function(){return Page.Range.getValue(p)},set:function(e){Page.Range.setValue(p,e,!0),M()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"BDIffusionRate",{get:function(){return Page.Range.getValue(b)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"speed",{get:function(){return Page.Range.getValue(E)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"brushSize",{get:function(){return Page.Range.getValue("brush-size-range-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayBrush",{get:function(){return!A&&Page.Checkbox.isChecked("brush-display-checkbox-id")},enumerable:!1,configurable:!0}),Object.defineProperty(e,"initialState",{get:function(){return A?o.EInitialState.CIRCLE:Page.Tabs.getValues(T)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"zoom",{get:function(){return Page.Range.getValue(y)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"blur",{get:function(){return Page.Range.getValue(R)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"displayMode",{get:function(){return e.parametersMap===o.EParametersMap.IMAGE?Page.Tabs.getValues(P)[0]:o.EDisplayMode.MONOCHROME},enumerable:!1,configurable:!0}),Object.defineProperty(e,"shading",{get:function(){return Page.Tabs.getValues(_)[0]},enumerable:!1,configurable:!0}),e.imageUploadObservers=[],e.imageDownloadObservers=[],e.canvasResizeObservers=[],e.resetObservers=[],e.blurChangeObservers=[],e}();t.Parameters=C,Page.Canvas.Observers.canvasResize.push((function(){O(C.canvasResizeObservers)}));var L=function(){O(C.resetObservers)};Page.Select.addObserver(d,L),Page.Button.addObserver("reset-button-id",L),Page.Tabs.addObserver(l,L),Page.Tabs.addObserver(P,L),Page.Tabs.addObserver(T,L),C.imageUploadObservers.push(L),Page.Tabs.addObserver(l,(function(){A=!1,I()})),Page.Tabs.addObserver(P,I),I();var x=function(){Page.Canvas.setIndicatorsVisibility(Page.Checkbox.isChecked(S))};Page.Checkbox.addObserver(S,x),x(),Page.Button.addObserver(m,(function(){Page.Range.setValue(g,.054,!0),Page.Range.setValue(h,.2097,!0),Page.Range.setValue(p,.062,!0),Page.Range.setValue(b,.105,!0)})),Page.Button.addObserver(v,(function(){Page.Tabs.setValues(l,[]),A=!0,I(),L()})),Page.Range.addObserver(R,(function(){O(C.blurChangeObservers)})),Page.FileControl.addUploadObserver(c,(function(e){if(1===e.length){var t=new FileReader;t.onload=function(){var e=new Image;e.addEventListener("load",(function(){for(var t=0,r=C.imageUploadObservers;t<r.length;t++)(0,r[t])(e)})),e.src=t.result},t.readAsDataURL(e[0])}}));var D="./resources/cat.jpg?v="+Page.version;s.registerLoadingObject(D);var F=new Image;function U(){if(C.parametersMap===o.EParametersMap.UNIFORM){var e=Page.Select.getValue(d),t=u.Presets[e];t&&(Page.Range.setValue(g,t.aFeeding),Page.Range.setValue(h,t.aDiffuse),Page.Range.setValue(p,t.bKilling),Page.Range.setValue(b,t.bDiffuse),Page.Range.setValue(E,t.speed),Page.Range.setValue(y,t.zoom),Page.Tabs.setValues(T,[t.initialState]),Page.Tabs.setValues(_,[t.shading]))}}F.addEventListener("load",(function(){s.registerLoadedObject(D);for(var e=0,t=C.imageUploadObservers;e<t.length;e++)(0,t[e])(F)})),F.src=D,Page.FileControl.addDownloadObserver("image-download-id",(function(){O(C.imageDownloadObservers),L()})),Page.Select.addObserver(d,U),Page.Tabs.addObserver(l,U),U()},470:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Presets=void 0;var a=r(689),i={0:{aFeeding:.015,aDiffuse:.21,bKilling:.049,bDiffuse:.105,speed:8,zoom:3,initialState:a.EInitialState.DISC,shading:a.EShading.COLORSCALE},1:{aFeeding:.037,aDiffuse:.5,bKilling:.059,bDiffuse:.342,speed:100,zoom:1,initialState:a.EInitialState.CIRCLE,shading:a.EShading.BINARY},2:{aFeeding:.058,aDiffuse:.21,bKilling:.063,bDiffuse:.105,speed:60,zoom:1,initialState:a.EInitialState.CIRCLE,shading:a.EShading.GREYSCALE},3:{aFeeding:.021,aDiffuse:.21,bKilling:.056,bDiffuse:.105,speed:10,zoom:2,initialState:a.EInitialState.CIRCLE,shading:a.EShading.COLORSCALE},4:{aFeeding:.049,aDiffuse:.21,bKilling:.061,bDiffuse:.105,speed:40,zoom:1,initialState:a.EInitialState.CIRCLE,shading:a.EShading.GREYSCALE},5:{aFeeding:.041,aDiffuse:.21,bKilling:.059,bDiffuse:.13,speed:80,zoom:1,initialState:a.EInitialState.DISC,shading:a.EShading.COLORSCALE},6:{aFeeding:.022,aDiffuse:.21,bKilling:.049,bDiffuse:.105,speed:10,zoom:1,initialState:a.EInitialState.CIRCLE,shading:a.EShading.GREYSCALE}};t.Presets=i},645:function(e,t,r){var a=this&&this.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,a){void 0===a&&(a=r),e[a]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ImageTexture=void 0;var o=r(753),s=n(r(268)),u={data:new Uint8ClampedArray([128,128,128,128]),width:1,height:1},l=function(){function e(e){this._width=-1,this._height=-1,this.id=o.gl.createTexture(),this.uploadDataToGPU(null!=e?e:u)}return e.prototype.loadFromUrl=function(e){var t=this;e=e+"?v="+Page.version,s.registerLoadingObject(e);var r=new Image;r.addEventListener("load",(function(){s.registerLoadedObject(e),t.uploadImageToGPU(r)})),r.src=e},e.prototype.uploadDataToGPU=function(e){this._width=e.width,this._height=e.height,o.gl.bindTexture(o.gl.TEXTURE_2D,this.id),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_WRAP_S,o.gl.CLAMP_TO_EDGE),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_WRAP_T,o.gl.CLAMP_TO_EDGE),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_MIN_FILTER,o.gl.LINEAR),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_MAG_FILTER,o.gl.LINEAR),o.gl.texImage2D(o.gl.TEXTURE_2D,0,o.gl.RGBA,e.width,e.height,0,o.gl.RGBA,o.gl.UNSIGNED_BYTE,e.data),o.gl.bindTexture(o.gl.TEXTURE_2D,null)},e.prototype.uploadImageToGPU=function(e){this._width=e.width,this._height=e.height,o.gl.bindTexture(o.gl.TEXTURE_2D,this.id),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_WRAP_S,o.gl.CLAMP_TO_EDGE),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_WRAP_T,o.gl.CLAMP_TO_EDGE),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_MIN_FILTER,o.gl.LINEAR),o.gl.texParameteri(o.gl.TEXTURE_2D,o.gl.TEXTURE_MAG_FILTER,o.gl.LINEAR),o.gl.texImage2D(o.gl.TEXTURE_2D,0,o.gl.RGBA,o.gl.RGBA,o.gl.UNSIGNED_BYTE,e),o.gl.bindTexture(o.gl.TEXTURE_2D,null)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}();t.ImageTexture=l},489:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RenderToTextureSwapable=void 0;var a=r(991),i=function(){function e(){this.previousTexture=new a.RenderToTexture,this.currentTexture=new a.RenderToTexture}return Object.defineProperty(e.prototype,"previous",{get:function(){return this.previousTexture.texture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this.currentTexture.texture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFramebuffer",{get:function(){return this.currentTexture.framebuffer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.previousTexture.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.previousTexture.height},enumerable:!1,configurable:!0}),e.prototype.reserveSpace=function(e,t){this.previousTexture.reserveSpace(e,t),this.currentTexture.reserveSpace(e,t)},e.prototype.swap=function(){var e=this.currentTexture;this.currentTexture=this.previousTexture,this.previousTexture=e},e}();t.RenderToTextureSwapable=i},991:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RenderToTexture=void 0;var a=r(753),i=function(){function e(){this.texture=a.gl.createTexture(),this.framebuffer=a.gl.createFramebuffer(),this._width=-1,this._height=-1}return e.prototype.reserveSpace=function(e,t){if(e=Math.ceil(e),t=Math.ceil(t),this.width!==e||this.height!==t){a.gl.bindTexture(a.gl.TEXTURE_2D,this.texture);var r=a.gl.RGBA;a.gl.texImage2D(a.gl.TEXTURE_2D,0,r,e,t,0,r,a.gl.UNSIGNED_BYTE,null),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MIN_FILTER,a.gl.LINEAR),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_S,a.gl.CLAMP_TO_EDGE),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_T,a.gl.CLAMP_TO_EDGE),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,this.framebuffer),a.gl.framebufferTexture2D(a.gl.FRAMEBUFFER,a.gl.COLOR_ATTACHMENT0,a.gl.TEXTURE_2D,this.texture,0),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,null),a.gl.bindTexture(a.gl.TEXTURE_2D,null),this._width=e,this._height=t}},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}();t.RenderToTexture=i},336:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Visor=void 0;var a,i=r(852),n=r(689),o=r(61);r(457),function(e){e.HORIZONTAL="horizontal",e.VERTICAL="vertical"}(a||(a={}));var s=function(){function e(){var t=Page.Canvas.getCanvasContainer();this.horizontalLine=e.createBar(a.HORIZONTAL,"B killing rate"),t.appendChild(this.horizontalLine.container),this.verticalLine=e.createBar(a.VERTICAL,"A feeding rate"),t.appendChild(this.verticalLine.container),Page.Canvas.getCanvas().addEventListener("click",(function(){if(o.Parameters.parametersMap===n.EParametersMap.VALUE_PICKING){var t=Page.Canvas.getMousePosition();o.Parameters.AFeedingRate=e.aimedFeedA(t),o.Parameters.BKillingRate=e.aimedKillB(t),o.Parameters.exitValuePickingMode()}}))}return e.prototype.update=function(){var t=Page.Canvas.getMousePosition(),r=o.Parameters.parametersMap===n.EParametersMap.VALUE_PICKING&&e.isInRange(0,1,t[0])&&e.isInRange(0,1,t[1]);if(r){this.horizontalLine.legendValue.textContent=e.toString(e.aimedKillB(t),5),this.verticalLine.legendValue.textContent=e.toString(e.aimedFeedA(t),5);var a,i=Page.Canvas.getSize(),s=Math.round(t[0]*i[0]),u=Math.round(t[1]*i[1]);this.horizontalLine.container.style.left=s+"px",s-.5*(a=this.horizontalLine.legendContainer.getBoundingClientRect().width)<0?this.horizontalLine.legendContainer.style.left=.5*a-s+"px":s+.5*a>i[0]?this.horizontalLine.legendContainer.style.left=i[0]-(s+.5*a)+"px":this.horizontalLine.legendContainer.style.left="",this.verticalLine.container.style.top=u+"px",u-.5*(a=this.verticalLine.legendContainer.getBoundingClientRect().height)<0?this.verticalLine.legendContainer.style.top=.5*a-u+"px":u+.5*a>i[1]?this.verticalLine.legendContainer.style.top=i[1]-(u+.5*a)+"px":this.verticalLine.legendContainer.style.top=""}var l=r?"":"none";this.horizontalLine.container.style.display=l,this.verticalLine.container.style.display=l},e.aimedFeedA=function(t){var r=.5+(e.clamp(0,1,1-t[1])-.5)/o.Parameters.zoom;return e.interpolate(i.Engine.A_FEEDING_MIN,i.Engine.A_FEEDING_MAX,r)},e.aimedKillB=function(t){var r=.5+(e.clamp(0,1,t[0])-.5)/o.Parameters.zoom;return e.interpolate(i.Engine.B_KILLING_MIN,i.Engine.B_KILLING_MAX,r)},e.createBar=function(e,t){var r=document.createElement("div");r.classList.add("visor-bar"),r.classList.add(e),r.style.display="none";var a=document.createElement("div");a.classList.add("visor-bar-legend");var i=document.createElement("span");i.textContent=t,a.appendChild(i),a.appendChild(document.createElement("br"));var n=document.createElement("span");return n.textContent="?",a.appendChild(n),r.appendChild(a),{container:r,legendContainer:a,legendValue:n}},e.clamp=function(e,t,r){return r<e?e:r>t?t:r},e.interpolate=function(e,t,r){return t*r+e*(1-r)},e.isInRange=function(e,t,r){return e<=r&&r<=t},e.toString=function(e,t){var r=e.toString(),a=r.indexOf(".");if(a<0)return r;var i=Math.min(t,r.length-(a+1));return r.substring(0,a+1+i)},e}();t.Visor=s}},t={};!function r(a){var i=t[a];if(void 0!==i)return i.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,r),n.exports}(633)}();
//# sourceMappingURL=main.min.js.map